/*
"Her eyes," said Bill Brewster, "are like--like--what's the word I want?"

He looked across at Lucille and Archie. Lucille was leaning forward with an eager and interested face; Archie was leaning back with his finger-tips together and his eyes closed. This was not the first time since their meeting in Beale's Auction Rooms that his brother-in-law had touched on the subject of the girl he had become engaged to marry during his trip to England. Indeed, Brother Bill had touched on very little else: and Archie, though of a sympathetic nature and fond of his young relative, was beginning to feel that he had heard all he wished to hear about Mabel Winchester. Lucille, on the other hand, was absorbed. Her brother's recital had thrilled her.

"Like--" said Bill. "Like--"

"Stars?" suggested Lucille.

"Stars," said Bill gratefully. "Exactly the word. Twin stars shining in a clear sky on a summer night. Her teeth are like--what shall I say?"

"Pearls?"

"Pearls. And her hair is a lovely brown, like leaves in autumn. In fact," concluded Bill, slipping down from the heights with something of a jerk, "she's a corker. Isn't she, Archie?"

Archie opened his eyes.

"Quite right, old top!" he said. "It was the only thing to do."

"What the devil are you talking about?" demanded Bill coldly. He had been suspicious all along of Archie's statement that he could listen better with his eyes shut.

"Eh? Oh, sorry! Thinking of something else."

"You were asleep."

"No, no, positively and distinctly not. Frightfully interested and rapt and all that, only I didn't quite get what you said."

"I said that Mabel was a corker."

"Oh, absolutely in every respect."

"There!" Bill turned to Lucille triumphantly. "You hear that? And Archie has only seen her photograph. Wait till he sees her in the flesh."

"My dear old chap!" said Archie, shocked. "Ladies present! I mean to say, what!"

"I'm afraid that father will be the one you'll find it hard to convince."

"Yes," admitted her brother gloomily.

"Your Mabel sounds perfectly charming, but--well, you know what father is. It IS a pity she sings in the chorus."

"She-hasn't much of a voice,"-argued Bill-in extenuation.

"All the same--"

Archie, the conversation having reached a topic on which he considered himself one of the greatest living authorities--to wit, the unlovable disposition of his father-in-law--addressed the meeting as one who has a right to be heard.

"Lucille's absolutely right, old thing.--Absolutely correct-o! Your esteemed progenitor is a pretty tough nut, and it's no good trying to get away from it.-And I'm sorry to have to say it, old bird, but, if you come bounding in with part of the personnel of the ensemble on your arm and try to dig a father's blessing out of him, he's extremely apt to stab you in the gizzard."

"I wish," said Bill, annoyed, "you wouldn't talk as though Mabel were the ordinary kind of chorus-girl. She's only on the stage because her mother's hard-up and she wants to educate her little brother."

"I say," said Archie, concerned. "Take my tip, old top. In chatting the matter over with the pater, don't dwell too much on that aspect of the affair.--I've been watching him closely, and it's about all he can stick, having to support ME. If you ring in a mother and a little brother on him, he'll crack under the strain."

"Well, I've got to do something about it. Mabel will be over here in a week."

"Great Scot! You never told us that."

"Yes. She's going to be in the new Billington show. And, naturally, she will expect to meet my family. I've told her all about you."

"Did you explain father to her?" asked Lucille.

"Well, I just said she mustn't mind him, as his bark was worse than his bite."

"Well," said Archie, thoughtfully, "he hasn't bitten me yet, so you may be right. But you've got to admit that he's a bit of a barker."

Lucille considered.

"Really, Bill, I think your best plan would be to go straight to father and tell him the whole thing.--You don't want him to hear about it in a roundabout way."

"The trouble is that, whenever I'm with father, I can't think of anything to say."

Archie found himself envying his father-in-law this merciful dispensation of Providence; for, where he himself was concerned, there had been no lack of eloquence on Bill's part. In the brief period in which he had known him, Bill had talked all the time and always on the one topic. As unpromising a subject as the tariff laws was easily diverted by him into a discussion of the absent Mabel.

"When I'm with father," said Bill, "I sort of lose my nerve, and yammer."

"Dashed awkward," said Archie, politely. He sat up suddenly. "I say! By Jove! I know what you want, old friend! Just thought of it!"

"That busy brain is never still," explained Lucille.

"Saw it in the paper this morning. An advertisement of a book, don't you know."

"I've no time for reading."

"You've time for reading this one, laddie, for you can't afford to miss it. It's a what-d'you-call-it book. What I mean to say is, if you read it and take its tips to heart, it guarantees to make you a convincing talker. The advertisement says so. The advertisement's all about a chappie whose name I forget, whom everybody loved because he talked so well. And, mark you, before he got hold of this book--The Personality That Wins was the name of it, if I remember rightly--he was known to all the lads in the office as Silent Samuel or something. Or it may have been Tongue-Tied Thomas. Well, one day he happened by good luck to blow in the necessary for the good old P. that W.'s, and now, whenever they want someone to go and talk Rockefeller or someone into lending them a million or so, they send for Samuel. Only now they call him Sammy the Spell-Binder and fawn upon him pretty copiously and all that. How about it, old son? How do we go?"

"What perfect nonsense," said Lucille.

"I don't know," said Bill, plainly impressed. "There might be something in it."

"Absolutely!" said Archie. "I remember it said, 'Talk convincingly, and no man will ever treat you with cold, unresponsive indifference.' Well, cold, unresponsive indifference is just what you don't want the pater to treat you with, isn't it, or is it, or isn't it, what? I mean, what?"

"It sounds all right," said Bill.

"It IS all right," said Archie. "It's a scheme! I'll go farther. It's an egg!"

"The idea I had," said Bill, "was to see if I couldn't get Mabel a job in some straight comedy. That would take the curse off the thing a bit. Then I wouldn't have to dwell on the chorus end of the business, you see."

"Much more sensible," said Lucille.

"But what a-deuce of a sweat"--argued Archie. "I mean to say, having to pop round and nose about and all that."

"Aren't you willing to take a little trouble for your stricken brother-in-law, worm?" said Lucille severely.

"Oh, absolutely! My idea was to get this book and coach the dear old chap. Rehearse him, don't you know. He could bone up the early chapters a bit and then drift round and try his convincing talk on me."

"It might be a good idea," said Bill reflectively.

"Well, I'll tell you what _I'm_ going to do," said Lucille. "I'm going to get Bill to introduce me to his Mabel, and, if she's as nice as he says she is, _I'll_ go to father and talk convincingly to him."

"You're an ace!" said Bill.

"Absolutely!" agreed Archie cordially. "MY partner, what! All the same, we ought to keep the book as a second string, you know. I mean to say, you are a young and delicately nurtured girl--full of sensibility and shrinking what's-its-name and all that--and you know what the jolly old pater is. He might bark at you and put you out of action in the first round. Well, then, if anything like that happened, don't you see, we could unleash old Bill, the trained silver-tongued expert, and let him have a shot. Personally, I'm all for the P. that W.'s."-"Me, too," said Bill.

Lucille looked at her watch.

"Good gracious! It's nearly one o'clock!"

"No!" Archie heaved himself up from his chair. "Well, it's a shame to break up this feast of reason and flow of soul and all that, but, if we don't leg it with some speed, we shall be late."

"We're lunching at the Nicholson's!" explained Lucille to her brother. "I wish you were coming too."

"Lunch!" Bill shook his head with a kind of tolerant scorn. "Lunch means nothing to me these days. I've other things to think of besides food." He looked as spiritual as his rugged features would permit. "I haven't written to Her yet to-day."

"But, dash it, old scream, if she's going to be over here in a week, what's the good of writing? The letter would cross her."

"I'm not mailing my letters to England." said Bill. "I'm keeping them for her to read when she arrives."

"My sainted aunt!" said Archie.

Devotion like this was something beyond his outlook.


*/
const $ = new Env('äº¬ä¸œç§è±†å¾—è±†');
//Node.jsç”¨æˆ·è¯·åœ¨jdCookie.jså¤„å¡«å†™äº¬ä¸œck;
//iosç­‰è½¯ä»¶ç”¨æˆ·ç›´æ¥ç”¨NobyDaçš„jd cookie
let jdNotify = true;//æ˜¯å¦å¼€å¯é™é»˜è¿è¡Œã€‚é»˜è®¤trueå¼€å¯
let cookiesArr = [], cookie = '', jdPlantBeanShareArr = [], isBox = false, notify, newShareCodes, option, message,subTitle;
//äº¬ä¸œæ¥å£åœ°å€
const JD_API_HOST = 'https://api.m.jd.com/client.action';
//åŠ©åŠ›å¥½å‹åˆ†äº«ç (æœ€å¤š3ä¸ª,å¦åˆ™åé¢çš„åŠ©åŠ›å¤±è´¥)
//æ­¤æ­¤å†…å®¹æ˜¯IOSç”¨æˆ·ä¸‹è½½è„šæœ¬åˆ°æœ¬åœ°ä½¿ç”¨ï¼Œå¡«å†™äº’åŠ©ç çš„åœ°æ–¹ï¼ŒåŒä¸€äº¬ä¸œè´¦å·çš„å¥½å‹äº’åŠ©ç è¯·ä½¿ç”¨@ç¬¦å·éš”å¼€ã€‚
//ä¸‹é¢ç»™å‡ºä¸¤ä¸ªè´¦å·çš„å¡«å†™ç¤ºä¾‹ï¼ˆiOSåªæ”¯æŒ2ä¸ªäº¬ä¸œè´¦å·ï¼‰
let shareCodes = ['']
let currentRoundId = null;//æœ¬æœŸæ´»åŠ¨id
let lastRoundId = null;//ä¸ŠæœŸid
let roundList = [];
let awardState = '';//ä¸ŠæœŸæ´»åŠ¨çš„äº¬è±†æ˜¯å¦æ”¶å–
let randomCount = $.isNode() ? 20 : 5;
!(async () => {
  await requireConfig();
  if (!cookiesArr[0]) {
    $.msg($.name, 'ã€æç¤ºã€‘è¯·å…ˆè·å–äº¬ä¸œè´¦å·ä¸€cookie\nç›´æ¥ä½¿ç”¨NobyDaçš„äº¬ä¸œç­¾åˆ°è·å–', 'https://bean.m.jd.com/bean/signIndex.action', {"open-url": "https://bean.m.jd.com/bean/signIndex.action"});
    return;
  }
  for (let i = 0; i < cookiesArr.length; i++) {
    if (cookiesArr[i]) {
      cookie = cookiesArr[i];
      $.UserName = decodeURIComponent(cookie.match(/pt_pin=(.+?);/) && cookie.match(/pt_pin=(.+?);/)[1])
      $.index = i + 1;
      $.isLogin = true;
      $.nickName = '';
      await TotalBean();
      console.log(`\nå¼€å§‹ã€äº¬ä¸œè´¦å·${$.index}ã€‘${$.nickName || $.UserName}\n`);
      if (!$.isLogin) {
        $.msg($.name, `ã€æç¤ºã€‘cookieå·²å¤±æ•ˆ`, `äº¬ä¸œè´¦å·${$.index} ${$.nickName || $.UserName}\nè¯·é‡æ–°ç™»å½•è·å–\nhttps://bean.m.jd.com/bean/signIndex.action`, {"open-url": "https://bean.m.jd.com/bean/signIndex.action"});

        if ($.isNode()) {
          await notify.sendNotify(`${$.name}cookieå·²å¤±æ•ˆ - ${$.UserName}`, `äº¬ä¸œè´¦å·${$.index} ${$.UserName}\nè¯·é‡æ–°ç™»å½•è·å–cookie`);
        }
        continue
      }
      message = '';
      subTitle = '';
      option = {};
      await shareCodesFormat();
      await jdPlantBean();
      await showMsg();
    }
  }
})().catch((e) => {
  $.log('', `âŒ ${$.name}, å¤±è´¥! åŸå› : ${e}!`, '')
}).finally(() => {
  $.done();
})

async function jdPlantBean() {
  try {
    console.log(`è·å–ä»»åŠ¡åŠåŸºæœ¬ä¿¡æ¯`)
    await plantBeanIndex();
    // console.log(plantBeanIndexResult.data.taskList);
    if ($.plantBeanIndexResult.code === '0') {
      const shareUrl = $.plantBeanIndexResult.data.jwordShareInfo.shareUrl
      $.myPlantUuid = getParam(shareUrl, 'plantUuid')
      console.log(`\nã€äº¬ä¸œè´¦å·${$.index}ï¼ˆ${$.nickName || $.UserName}ï¼‰çš„${$.name}å¥½å‹äº’åŠ©ç ã€‘${$.myPlantUuid}\n`);
      roundList = $.plantBeanIndexResult.data.roundList;
      currentRoundId = roundList[1].roundId;//æœ¬æœŸçš„roundId
      lastRoundId = roundList[0].roundId;//ä¸ŠæœŸçš„roundId
      awardState = roundList[0].awardState;
      $.taskList = $.plantBeanIndexResult.data.taskList;
      subTitle = `ã€äº¬ä¸œæ˜µç§°ã€‘${$.plantBeanIndexResult.data.plantUserInfo.plantNickName}`;
      message += `ã€ä¸ŠæœŸæ—¶é—´ã€‘${roundList[0].dateDesc.replace('ä¸ŠæœŸ ', '')}\n`;
      message += `ã€ä¸ŠæœŸæˆé•¿å€¼ã€‘${roundList[0].growth}\n`;
      await receiveNutrients();//å®šæ—¶é¢†å–è¥å…»æ¶²
      await doHelp();//åŠ©åŠ›
      await doTask();//åšæ—¥å¸¸ä»»åŠ¡
      await doEgg();
      await stealFriendWater();
      await doCultureBean();
      await doGetReward();
      await showTaskProcess();
      await plantShareSupportList();
    } else {
      console.log(`ç§è±†å¾—è±†-åˆå§‹å¤±è´¥:  ${JSON.stringify($.plantBeanIndexResult)}`);
    }
  } catch (e) {
    $.logErr(e);
  }
}
async function doGetReward() {
  console.log(`ã€ä¸Šè½®äº¬è±†ã€‘${awardState === '4' ? 'é‡‡æ‘˜ä¸­' : awardState === '5' ? 'å¯æ”¶è·äº†' : 'å·²é¢†å–'}`);
  if (awardState === '4') {
    //äº¬è±†é‡‡æ‘˜ä¸­...
    message += `ã€ä¸ŠæœŸçŠ¶æ€ã€‘${roundList[0].tipBeanEndTitle}\n`;
  } else if (awardState === '5') {
    //æ”¶è·
    await getReward();
    console.log('å¼€å§‹é¢†å–äº¬è±†');
    if ($.getReward.code === '0') {
      console.log('äº¬è±†é¢†å–æˆåŠŸ');
      message += `ã€ä¸ŠæœŸå…‘æ¢äº¬è±†ã€‘${$.getReward.data.awardBean}ä¸ª\n`;
      $.msg($.name, subTitle, message);
      if ($.isNode()) {
        await notify.sendNotify(`${$.name} - è´¦å·${$.index} - ${$.nickName || $.UserName}`, `äº¬ä¸œè´¦å·${$.index} ${$.nickName}\n${message}`);
      }
    }
  } else if (awardState === '6') {
    //äº¬è±†å·²é¢†å–
    message += `ã€ä¸ŠæœŸå…‘æ¢äº¬è±†ã€‘${roundList[0].awardBeans}ä¸ª\n`;
  }
  if (roundList[1].dateDesc.indexOf('æœ¬æœŸ ') > -1) {
    roundList[1].dateDesc = roundList[1].dateDesc.substr(roundList[1].dateDesc.indexOf('æœ¬æœŸ ') + 3, roundList[1].dateDesc.length);
  }
  message += `ã€æœ¬æœŸæ—¶é—´ã€‘${roundList[1].dateDesc}\n`;
  message += `ã€æœ¬æœŸæˆé•¿å€¼ã€‘${roundList[1].growth}\n`;
}
async function doCultureBean() {
  await plantBeanIndex();
  if ($.plantBeanIndexResult.code === '0') {
    const plantBeanRound = $.plantBeanIndexResult.data.roundList[1]
    if (plantBeanRound.roundState === '2') {
      //æ”¶å–è¥å…»æ¶²
      console.log(`å¼€å§‹æ”¶å–è¥å…»æ¶²`)
      for (let bubbleInfo of plantBeanRound.bubbleInfos) {
        console.log(`æ”¶å–-${bubbleInfo.name}-çš„è¥å…»æ¶²`)
        await cultureBean(plantBeanRound.roundId, bubbleInfo.nutrientsType)
        console.log(`æ”¶å–è¥å…»æ¶²ç»“æœ:${JSON.stringify($.cultureBeanRes)}`)
      }
    }
  } else {
    console.log(`plantBeanIndexResult:${JSON.stringify($.plantBeanIndexResult)}`)
  }
}
async function stealFriendWater() {
  await stealFriendList();
  if ($.stealFriendList.code === '0') {
    if ($.stealFriendList.data.tips) {
      console.log('å·å–å¥½å‹è¥å…»æ¶²ä»Šæ—¥å·²è¾¾ä¸Šé™');
      return
    }
    if ($.stealFriendList.data && $.stealFriendList.data.friendInfoList && $.stealFriendList.data.friendInfoList.length > 0) {
      let nowTimes = new Date(new Date().getTime() + new Date().getTimezoneOffset()*60*1000 + 8*60*60*1000);
      for (let item of $.stealFriendList.data.friendInfoList) {
        if (new Date(nowTimes).getHours() === 20) {
          if (item.nutrCount >= 2) {
            // console.log(`å¯ä»¥å·çš„å¥½å‹çš„ä¿¡æ¯::${JSON.stringify(item)}`);
            console.log(`å¯ä»¥å·çš„å¥½å‹çš„ä¿¡æ¯paradiseUuid::${JSON.stringify(item.paradiseUuid)}`);
            await collectUserNutr(item.paradiseUuid);
            console.log(`å·å–å¥½å‹è¥å…»æ¶²æƒ…å†µ:${JSON.stringify($.stealFriendRes)}`)
            if ($.stealFriendRes.code === '0') {
              console.log(`å·å–å¥½å‹è¥å…»æ¶²æˆåŠŸ`)
            }
          }
        } else {
          if (item.nutrCount >= 3) {
            // console.log(`å¯ä»¥å·çš„å¥½å‹çš„ä¿¡æ¯::${JSON.stringify(item)}`);
            console.log(`å¯ä»¥å·çš„å¥½å‹çš„ä¿¡æ¯paradiseUuid::${JSON.stringify(item.paradiseUuid)}`);
            await collectUserNutr(item.paradiseUuid);
            console.log(`å·å–å¥½å‹è¥å…»æ¶²æƒ…å†µ:${JSON.stringify($.stealFriendRes)}`)
            if ($.stealFriendRes.code === '0') {
              console.log(`å·å–å¥½å‹è¥å…»æ¶²æˆåŠŸ`)
            }
          }
        }
      }
    }
  }
}
async function doEgg() {
  await egg();
  if ($.plantEggLotteryRes.code === '0') {
    if ($.plantEggLotteryRes.data.restLotteryNum > 0) {
      const eggL = new Array($.plantEggLotteryRes.data.restLotteryNum).fill('');
      console.log(`ç›®å‰å…±æœ‰${eggL.length}æ¬¡æ‰­è›‹çš„æœºä¼š`)
      for (let i = 0; i < eggL.length; i++) {
        console.log(`å¼€å§‹ç¬¬${i + 1}æ¬¡æ‰­è›‹`);
        await plantEggDoLottery();
        console.log(`å¤©å¤©æ‰­è›‹æˆåŠŸï¼š${JSON.stringify($.plantEggDoLotteryResult)}`);
      }
    } else {
      console.log('æš‚æ— æ‰­è›‹æœºä¼š')
    }
  } else {
    console.log('æŸ¥è¯¢å¤©å¤©æ‰­è›‹çš„æœºä¼šå¤±è´¥')
  }
}
async function doTask() {
  if ($.taskList && $.taskList.length > 0) {
    for (let item of $.taskList) {
      if (item.isFinished === 1) {
        console.log(`${item.taskName} ä»»åŠ¡å·²å®Œæˆ\n`);
        continue;
      } else {
        if (item.taskType === 8) {
          console.log(`\nã€${item.taskName}ã€‘ä»»åŠ¡æœªå®Œæˆ,éœ€è‡ªè¡Œæ‰‹åŠ¨å»äº¬ä¸œAPPå®Œæˆï¼Œ${item.desc}è¥å…»æ¶²\n`)
        } else {
          console.log(`\nã€${item.taskName}ã€‘ä»»åŠ¡æœªå®Œæˆ,${item.desc}è¥å…»æ¶²\n`)
        }
      }
      if (item.dailyTimes === 1 && item.taskType !== 8) {
        console.log(`\nå¼€å§‹åš ${item.taskName}ä»»åŠ¡`);
        // $.receiveNutrientsTaskRes = await receiveNutrientsTask(item.taskType);
        await receiveNutrientsTask(item.taskType);
        console.log(`åš ${item.taskName}ä»»åŠ¡ç»“æœ:${JSON.stringify($.receiveNutrientsTaskRes)}\n`);
      }
      if (item.taskType === 3) {
        //æµè§ˆåº—é“º
        console.log(`å¼€å§‹åš ${item.taskName}ä»»åŠ¡`);
        let unFinishedShopNum = item.totalNum - item.gainedNum;
        if (unFinishedShopNum === 0) {
          continue
        }
        await shopTaskList();
        const { data } = $.shopTaskListRes;
        let goodShopListARR = [], moreShopListARR = [], shopList = [];
        const { goodShopList, moreShopList } = data;
        for (let i of goodShopList) {
          if (i.taskState === '2') {
            goodShopListARR.push(i);
          }
        }
        for (let j of moreShopList) {
          if (j.taskState === '2') {
            moreShopListARR.push(j);
          }
        }
        shopList = goodShopListARR.concat(moreShopListARR);
        for (let shop of shopList) {
          const { shopId, shopTaskId } = shop;
          const body = {
            "monitor_refer": "plant_shopNutrientsTask",
            "shopId": shopId,
            "shopTaskId": shopTaskId
          }
          const shopRes = await requestGet('shopNutrientsTask', body);
          console.log(`shopResç»“æœ:${JSON.stringify(shopRes)}`);
          if (shopRes.code === '0') {
            if (shopRes.data && shopRes.data.nutrState && shopRes.data.nutrState === '1') {
              unFinishedShopNum --;
            }
          }
          if (unFinishedShopNum <= 0) {
            console.log(`${item.taskName}ä»»åŠ¡å·²åšå®Œ\n`)
            break;
          }
        }
      }
      if (item.taskType === 5) {
        //æŒ‘é€‰å•†å“
        console.log(`å¼€å§‹åš ${item.taskName}ä»»åŠ¡`);
        let unFinishedProductNum = item.totalNum - item.gainedNum;
        if (unFinishedProductNum === 0) {
          continue
        }
        await productTaskList();
        // console.log('productTaskList', $.productTaskList);
        const { data } = $.productTaskList;
        let productListARR = [], productList = [];
        const { productInfoList } = data;
        for (let i = 0; i < productInfoList.length; i++) {
          for (let j = 0; j < productInfoList[i].length; j++){
            productListARR.push(productInfoList[i][j]);
          }
        }
        for (let i of productListARR) {
          if (i.taskState === '2') {
            productList.push(i);
          }
        }
        for (let product of productList) {
          const { skuId, productTaskId } = product;
          const body = {
            "monitor_refer": "plant_productNutrientsTask",
            "productTaskId": productTaskId,
            "skuId": skuId
          }
          const productRes = await requestGet('productNutrientsTask', body);
          if (productRes.code === '0') {
            // console.log('nutrState', productRes)
            //è¿™é‡Œæ·»åŠ å¤šé‡åˆ¤æ–­,æœ‰æ—¶å€™ä¼šå‡ºç°æ´»åŠ¨å¤ªç«çˆ†çš„é—®é¢˜,å¯¼è‡´nutrStateæ²¡æœ‰
            if (productRes.data && productRes.data.nutrState && productRes.data.nutrState === '1') {
              unFinishedProductNum --;
            }
          }
          if (unFinishedProductNum <= 0) {
            console.log(`${item.taskName}ä»»åŠ¡å·²åšå®Œ\n`)
            break;
          }
        }
      }
      if (item.taskType === 10) {
        //å…³æ³¨é¢‘é“
        console.log(`å¼€å§‹åš ${item.taskName}ä»»åŠ¡`);
        let unFinishedChannelNum = item.totalNum - item.gainedNum;
        if (unFinishedChannelNum === 0) {
          continue
        }
        await plantChannelTaskList();
        const { data } = $.plantChannelTaskList;
        // console.log('goodShopList', data.goodShopList);
        // console.log('moreShopList', data.moreShopList);
        let goodChannelListARR = [], normalChannelListARR = [], channelList = [];
        const { goodChannelList, normalChannelList } = data;
        for (let i of goodChannelList) {
          if (i.taskState === '2') {
            goodChannelListARR.push(i);
          }
        }
        for (let j of normalChannelList) {
          if (j.taskState === '2') {
            normalChannelListARR.push(j);
          }
        }
        channelList = goodChannelListARR.concat(normalChannelListARR);
        for (let channelItem of channelList) {
          const { channelId, channelTaskId } = channelItem;
          const body = {
            "channelId": channelId,
            "channelTaskId": channelTaskId
          }
          const channelRes = await requestGet('plantChannelNutrientsTask', body);
          console.log(`channelResç»“æœ:${JSON.stringify(channelRes)}`);
          if (channelRes.code === '0') {
            if (channelRes.data && channelRes.data.nutrState && channelRes.data.nutrState === '1') {
              unFinishedChannelNum --;
            }
          }
          if (unFinishedChannelNum <= 0) {
            console.log(`${item.taskName}ä»»åŠ¡å·²åšå®Œ\n`)
            break;
          }
        }
      }
    }
  }
}
function showTaskProcess() {
  return new Promise(async resolve => {
    await plantBeanIndex();
    $.taskList = $.plantBeanIndexResult.data.taskList;
    if ($.taskList && $.taskList.length > 0) {
      console.log("     ä»»åŠ¡   è¿›åº¦");
      for (let item of $.taskList) {
        console.log(`[${item["taskName"]}]  ${item["gainedNum"]}/${item["totalNum"]}   ${item["isFinished"]}`);
      }
    }
    resolve()
  })
}
//åŠ©åŠ›å¥½å‹
async function doHelp() {
  for (let plantUuid of $.newShareCodes) {
    console.log(`å¼€å§‹åŠ©åŠ›äº¬ä¸œè´¦å·${$.index} - ${$.nickName}çš„å¥½å‹: ${plantUuid}`);
    if (!plantUuid) continue;
    if (plantUuid === $.myPlantUuid) {
      console.log(`\nè·³è¿‡è‡ªå·±çš„plantUuid\n`)
      continue
    }
    await helpShare(plantUuid);
    if ($.helpResult.code === '0') {
      // console.log(`åŠ©åŠ›å¥½å‹ç»“æœ: ${JSON.stringify($.helpResult.data.helpShareRes)}`);
      if ($.helpResult.data.helpShareRes) {
        if ($.helpResult.data.helpShareRes.state === '1') {
          console.log(`åŠ©åŠ›å¥½å‹${plantUuid}æˆåŠŸ`)
          console.log(`${$.helpResult.data.helpShareRes.promptText}\n`);
        } else if ($.helpResult.data.helpShareRes.state === '2') {
          console.log('æ‚¨ä»Šæ—¥åŠ©åŠ›çš„æœºä¼šå·²è€—å°½ï¼Œå·²ä¸èƒ½å†å¸®åŠ©å¥½å‹åŠ©åŠ›äº†\n');
          break;
        } else if ($.helpResult.data.helpShareRes.state === '3') {
          console.log('è¯¥å¥½å‹ä»Šæ—¥å·²æ»¡9äººåŠ©åŠ›/20ç“¶è¥å…»æ¶²,æ˜å¤©å†æ¥ä¸ºTaåŠ©åŠ›å§\n')
        } else if ($.helpResult.data.helpShareRes.state === '4') {
          console.log(`${$.helpResult.data.helpShareRes.promptText}\n`)
        } else {
          console.log(`åŠ©åŠ›å…¶ä»–æƒ…å†µï¼š${JSON.stringify($.helpResult.data.helpShareRes)}`);
        }
      }
    } else {
      console.log(`åŠ©åŠ›å¥½å‹å¤±è´¥: ${JSON.stringify($.helpResult)}`);
    }
  }
}
function showMsg() {
  $.log(`\n${message}\n`);
  jdNotify = $.getdata('jdPlantBeanNotify') ? $.getdata('jdPlantBeanNotify') : jdNotify;
  if (!jdNotify || jdNotify === 'false') {
    $.msg($.name, subTitle, message);
  }
}
// ================================================æ­¤å¤„æ˜¯API=================================
//æ¯è½®ç§è±†æ´»åŠ¨è·å–ç»“æŸå,è‡ªåŠ¨æ”¶å–äº¬è±†
async function getReward() {
  const body = {
    "roundId": lastRoundId
  }
  $.getReward = await request('receivedBean', body);
}
//æ”¶å–è¥å…»æ¶²
async function cultureBean(currentRoundId, nutrientsType) {
  let functionId = arguments.callee.name.toString();
  let body = {
    "roundId": currentRoundId,
    "nutrientsType": nutrientsType,
  }
  $.cultureBeanRes = await request(functionId, body);
}
//å·è¥å…»æ¶²å¤§äºç­‰äº3ç“¶çš„å¥½å‹
//â‘ æŸ¥è¯¢å¥½å‹åˆ—è¡¨
async function stealFriendList() {
  const body = {
    pageNum: '1'
  }
  $.stealFriendList = await request('plantFriendList', body);
}

//â‘¡æ‰§è¡Œå·å¥½å‹è¥å…»æ¶²çš„åŠ¨ä½œ
async function collectUserNutr(paradiseUuid) {
  console.log('å¼€å§‹å·å¥½å‹');
  // console.log(paradiseUuid);
  let functionId = arguments.callee.name.toString();
  const body = {
    "paradiseUuid": paradiseUuid,
    "roundId": currentRoundId
  }
  $.stealFriendRes = await request(functionId, body);
}
async function receiveNutrients() {
  $.receiveNutrientsRes = await request('receiveNutrients', {"roundId": currentRoundId, "monitor_refer": "plant_receiveNutrients"})
  // console.log(`å®šæ—¶é¢†å–è¥å…»æ¶²ç»“æœ:${JSON.stringify($.receiveNutrientsRes)}`)
}
async function plantEggDoLottery() {
  $.plantEggDoLotteryResult = await requestGet('plantEggDoLottery');
}
//æŸ¥è¯¢å¤©å¤©æ‰­è›‹çš„æœºä¼š
async function egg() {
  $.plantEggLotteryRes = await requestGet('plantEggLotteryIndex');
}
async function productTaskList() {
  let functionId = arguments.callee.name.toString();
  $.productTaskList = await requestGet(functionId, {"monitor_refer": "plant_productTaskList"});
}
async function plantChannelTaskList() {
  let functionId = arguments.callee.name.toString();
  $.plantChannelTaskList = await requestGet(functionId);
  // console.log('$.plantChannelTaskList', $.plantChannelTaskList)
}
async function shopTaskList() {
  let functionId = arguments.callee.name.toString();
  $.shopTaskListRes = await requestGet(functionId, {"monitor_refer": "plant_receiveNutrients"});
  // console.log('$.shopTaskListRes', $.shopTaskListRes)
}
async function receiveNutrientsTask(awardType) {
  const functionId = arguments.callee.name.toString();
  const body = {
    "monitor_refer": "receiveNutrientsTask",
    "awardType": `${awardType}`,
  }
  $.receiveNutrientsTaskRes = await requestGet(functionId, body);
}
async function plantShareSupportList() {
  $.shareSupportList = await requestGet('plantShareSupportList', {"roundId": ""});
  if ($.shareSupportList && $.shareSupportList.code === '0') {
    const { data } = $.shareSupportList;
    //å½“æ—¥åŒ—äº¬æ—¶é—´0ç‚¹æ—¶é—´æˆ³
    const UTC8_Zero_Time = parseInt((Date.now() + 28800000) / 86400000) * 86400000 - 28800000;
    //æ¬¡æ—¥åŒ—äº¬æ—¶é—´0ç‚¹æ—¶é—´æˆ³
    const UTC8_End_Time = parseInt((Date.now() + 28800000) / 86400000) * 86400000 - 28800000 + (24 * 60 * 60 * 1000);
    let friendList = [];
    data.map(item => {
      if (UTC8_Zero_Time <= item['createTime'] && item['createTime'] < UTC8_End_Time) {
        friendList.push(item);
      }
    })
    message += `ã€åŠ©åŠ›æ‚¨çš„å¥½å‹ã€‘å…±${friendList.length}äºº`;
  } else {
    console.log(`å¼‚å¸¸æƒ…å†µï¼š${JSON.stringify($.shareSupportList)}`)
  }
}
//åŠ©åŠ›å¥½å‹çš„api
async function helpShare(plantUuid) {
  console.log(`\nå¼€å§‹åŠ©åŠ›å¥½å‹: ${plantUuid}`);
  const body = {
    "plantUuid": plantUuid,
    "wxHeadImgUrl": "",
    "shareUuid": "",
    "followType": "1",
  }
  $.helpResult = await request(`plantBeanIndex`, body);
  console.log(`åŠ©åŠ›ç»“æœçš„code:${$.helpResult && $.helpResult.code}`);
}
async function plantBeanIndex() {
  $.plantBeanIndexResult = await request('plantBeanIndex');//plantBeanIndexBody
}
getArrRandomly = (arr) => {
  var len = arr.length;
  for (var i = len - 1; i >= 0; i--) {
    var randomIndex = Math.floor(Math.random() * (i + 1));
    var itemIndex = arr[randomIndex];
    arr[randomIndex] = arr[i];
    arr[i] = itemIndex;
  }
  return arr;
}


getRandomArr = (arr=[],num) => {
  const tmpArr = getArrRandomly(arr);
  let arrList = [];
  for (let i = 0; i < num; i++) {
    arrList.push(tmpArr[i]);
  };
  return arrList;
}


function readShareCode() {
console.log(`å¼€å§‹è¯»å–æœ±ä¸½å¨œã€‚ã€‚ã€‚`)
return new Promise(async resolve => {
  $.get({url: `https://raw.githubusercontent.com/jd1994527314/iosrule/cs/JD_TG/ZD.json`, 'timeout': 10000}, (err, resp, data) => {
    try {
      if (err) {
        console.log(`${JSON.stringify(err)}`)
        console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
      } else {
        if (data) {
          console.log(`éšæœºå–${randomCount}ä¸ªç æ”¾åˆ°æ‚¨å›ºå®šçš„äº’åŠ©ç åé¢(ä¸å½±å“å·²æœ‰å›ºå®šäº’åŠ©)`)
          data = JSON.parse(data);
        }
      }
    } catch (e) {
      $.logErr(e, resp)
    } finally {
      resolve(data);
    }
  })
  await $.wait(10000);
  resolve()
})
}
//æ ¼å¼åŒ–åŠ©åŠ›ç 
function shareCodesFormat() {
return new Promise(async resolve => {
  // console.log(`ç¬¬${$.index}ä¸ªäº¬ä¸œè´¦å·çš„åŠ©åŠ›ç :::${$.shareCodesArr[$.index - 1]}`)
  $.newShareCodes = [];
 
  const readShareCodeRes = await readShareCode();
  
  if (readShareCodeRes && readShareCodeRes.code === 200) {
$.newShareCodes = [...new Set([...$.newShareCodes, ...(getRandomArr(getArrRandomly(readShareCodeRes.data),randomCount)|| [])])];
  }
  
  console.log(`ç¬¬${$.index}ä¸ªäº¬ä¸œè´¦å·å°†è¦åŠ©åŠ›çš„å¥½å‹${JSON.stringify($.newShareCodes)}`)





  resolve();
})
}

function requireConfig() {
  return new Promise(resolve => {
    console.log('å¼€å§‹è·å–ç§è±†å¾—è±†é…ç½®æ–‡ä»¶\n')
    notify = $.isNode() ? require('./sendNotify') : '';
    //Node.jsç”¨æˆ·è¯·åœ¨jdCookie.jså¤„å¡«å†™äº¬ä¸œck;
    const jdCookieNode = $.isNode() ? require('./jdCookie.js') : '';
    const jdPlantBeanShareCodes = $.isNode() ? require('./jdPlantBeanShareCodes.js') : '';
    //IOSç­‰ç”¨æˆ·ç›´æ¥ç”¨NobyDaçš„jd cookie
    if ($.isNode()) {
      Object.keys(jdCookieNode).forEach((item) => {
        if (jdCookieNode[item]) {
          cookiesArr.push(jdCookieNode[item])
        }
      })
      if (process.env.JD_DEBUG && process.env.JD_DEBUG === 'false') console.log = () => {};
    } else {
      let cookiesData = $.getdata('CookiesJD') || "[]";
      cookiesData = jsonParse(cookiesData);
      cookiesArr = cookiesData.map(item => item.cookie);
      cookiesArr.reverse();
      cookiesArr.push(...[$.getdata('CookieJD2'), $.getdata('CookieJD')]);
      cookiesArr.reverse();
      cookiesArr = cookiesArr.filter(item => item !== "" && item !== null && item !== undefined);
    }
    console.log(`å…±${cookiesArr.length}ä¸ªäº¬ä¸œè´¦å·\n`)
    if ($.isNode()) {
      Object.keys(jdPlantBeanShareCodes).forEach((item) => {
        if (jdPlantBeanShareCodes[item]) {
          jdPlantBeanShareArr.push(jdPlantBeanShareCodes[item])
        }
      })
    } else {
      const boxShareCodeArr = ['jd_plantBean1', 'jd_plantBean2', 'jd_plantBean3'];
      const boxShareCodeArr2 = ['jd2_plantBean1', 'jd2_plantBean2', 'jd2_plantBean3'];
      const isBox1 = boxShareCodeArr.some((item) => {
        const boxShareCode = $.getdata(item);
        return (boxShareCode !== undefined && boxShareCode !== null && boxShareCode !== '');
      });
      const isBox2 = boxShareCodeArr2.some((item) => {
        const boxShareCode = $.getdata(item);
        return (boxShareCode !== undefined && boxShareCode !== null && boxShareCode !== '');
      });
      isBox = isBox1 ? isBox1 : isBox2;
      if (isBox1) {
        let temp = [];
        for (const item of boxShareCodeArr) {
          if ($.getdata(item)) {
            temp.push($.getdata(item))
          }
        }
        jdPlantBeanShareArr.push(temp.join('@'));
      }
      if (isBox2) {
        let temp = [];
        for (const item of boxShareCodeArr2) {
          if ($.getdata(item)) {
            temp.push($.getdata(item))
          }
        }
        jdPlantBeanShareArr.push(temp.join('@'));
      }
    }
    // console.log(`\nç§è±†å¾—è±†åŠ©åŠ›ç ::${JSON.stringify(jdPlantBeanShareArr)}`);
    console.log(`æ‚¨æä¾›äº†${jdPlantBeanShareArr.length}ä¸ªè´¦å·çš„ç§è±†å¾—è±†åŠ©åŠ›ç \n`);
    resolve()
  })
}
function requestGet(function_id, body = {}) {
  if (!body.version) {
    body["version"] = "9.0.0.1";
  }
  body["monitor_source"] = "plant_app_plant_index";
  body["monitor_refer"] = "";
  return new Promise(async resolve => {
    await $.wait(2000);
    const option = {
      url: `${JD_API_HOST}?functionId=${function_id}&body=${escape(JSON.stringify(body))}&appid=ld`,
      headers: {
        'Cookie': cookie,
        'Host': 'api.m.jd.com',
        'Accept': '*/*',
        'Connection': 'keep-alive',
        'User-Agent': 'JD4iPhone/167283 (iPhone;iOS 13.6.1;Scale/3.00)',
        'Accept-Language': 'zh-Hans-CN;q=1,en-CN;q=0.9',
        'Accept-Encoding': 'gzip, deflate, br',
        'Content-Type': "application/x-www-form-urlencoded"
      },
      timeout: 10000,
    };
    $.get(option, (err, resp, data) => {
      try {
        if (err) {
          console.log('\nç§è±†å¾—è±†: APIæŸ¥è¯¢è¯·æ±‚å¤±è´¥ â€¼ï¸â€¼ï¸')
          $.logErr(err);
        } else {
          data = JSON.parse(data);
        }
      } catch (e) {
        $.logErr(e, resp);
      } finally {
        resolve(data);
      }
    })
  })
}
function TotalBean() {
  return new Promise(async resolve => {
    const options = {
      "url": `https://wq.jd.com/user/info/QueryJDUserInfo?sceneval=2`,
      "headers": {
        "Accept": "application/json,text/plain, */*",
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "zh-cn",
        "Connection": "keep-alive",
        "Cookie": cookie,
        "Referer": "https://wqs.jd.com/my/jingdou/my.shtml?sceneval=2",
        "User-Agent": $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0")
      },
      "timeout": 10000,
    }
    $.post(options, (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (data) {
            data = JSON.parse(data);
            if (data['retcode'] === 13) {
              $.isLogin = false; //cookieè¿‡æœŸ
              return
            }
            $.nickName = data['base'].nickname;
          } else {
            console.log(`äº¬ä¸œæœåŠ¡å™¨è¿”å›ç©ºæ•°æ®`)
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve();
      }
    })
  })
}
function request(function_id, body = {}){
  return new Promise(async resolve => {
    await $.wait(2000);
    $.post(taskUrl(function_id, body), (err, resp, data) => {
      try {
        if (err) {
          console.log('\nç§è±†å¾—è±†: APIæŸ¥è¯¢è¯·æ±‚å¤±è´¥ â€¼ï¸â€¼ï¸')
          console.log(`function_id:${function_id}`)
          $.logErr(err);
        } else {
          data = JSON.parse(data);
        }
      } catch (e) {
        $.logErr(e, resp);
      } finally {
        resolve(data);
      }
    })
  })
}
function taskUrl(function_id, body) {
  body["version"] = "9.2.4.0";
  body["monitor_source"] = "plant_app_plant_index";
  body["monitor_refer"] = "";
  return {
    url: JD_API_HOST,
    body: `functionId=${function_id}&body=${escape(JSON.stringify(body))}&appid=ld&client=apple&area=19_1601_50258_51885&build=167490&clientVersion=9.3.2`,
    headers: {
      "Cookie": cookie,
      "Host": "api.m.jd.com",
      "Accept": "*/*",
      "Connection": "keep-alive",
      "User-Agent": $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0"),
      "Accept-Language": "zh-Hans-CN;q=1,en-CN;q=0.9",
      "Accept-Encoding": "gzip, deflate, br",
      "Content-Type": "application/x-www-form-urlencoded"
    },
    timeout: 10000,
  }
}
function getParam(url, name) {
  const reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i")
  const r = url.match(reg)
  if (r != null) return unescape(r[2]);
  return null;
}
function jsonParse(str) {
  if (typeof str == "string") {
    try {
      return JSON.parse(str);
    } catch (e) {
      console.log(e);
      $.msg($.name, '', 'è¯·å‹¿éšæ„åœ¨BoxJsè¾“å…¥æ¡†ä¿®æ”¹å†…å®¹\nå»ºè®®é€šè¿‡è„šæœ¬å»è·å–cookie')
      return [];
    }
  }
}
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`ğŸ””${this.name}, å¼€å§‹!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============ğŸ“£ç³»ç»Ÿé€šçŸ¥ğŸ“£=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`â—ï¸${this.name}, é”™è¯¯!`,t.stack):this.log("",`â—ï¸${this.name}, é”™è¯¯!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`ğŸ””${this.name}, ç»“æŸ! ğŸ•› ${s} ç§’`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
