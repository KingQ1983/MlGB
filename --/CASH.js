/*

钟南山：世上所有疾病都是假象，读完醍醐灌顶

环球文摘经典  今天

《环球文摘经典》环球文摘，每日经典！

文/静心阅读（ID:jxydh8）

如果有一个人跟你说，「天下无病」，疾病只不过是个假相，不是本质。你会怎么想？

你会有如醍醐灌顶，微笑点头，发现疾病原来只是一个代号，很大程度上消除了对疾病的恐惧；还是会觉得这个说法虚无缥缈不接地气，甚至心想：「说这话简直是站着说话不腰疼？」

什么是病？病的本质是什么？
为什么说病名只是一个代号？
什么是癌？为什么会得癌症？
被诊断为癌症的人应该怎么做？

图片

01
疾病是我们最好的朋友之一　

天下本无病。但生病时，我们的痛苦实实在在，这时候看「天下无病」这四个字，多少觉得有点虚无缥缈。

「我不是看不见症状，或者不了解病人的痛苦，而是强调一点：疾病是我们最好的朋友之一。病是以某一种方式来提醒你，让你知道你的生活方式或者思维模式出问题了。

如果你因为受到这位朋友的启发，转身看到了自己的问题并改变它，这个病就作为客人走了，不会继续留在身体里。」

感冒、高血压、高血脂、心脏病……所有的病名都只是一个代号，比如这个人叫张三，那个人叫李四。我们很容易被代号困住，忘记去看它背后的实相。

比如你受了风寒，这时候是病这位朋友用咳嗽或者流鼻涕的形式来提醒你受了寒，让你知道该采取一些手段把寒气驱赶出去；

当你吃了一些不新鲜或者不卫生的食物，这位朋友就以拉肚子的形式提醒你；

当你长期睡眠不足，它就以眼睛发红、脾气暴躁来提醒你，把问题的存在表达给你。

如果没有疾病的提醒，我们也许就对身体的各种超负荷和不平衡无知无觉，一直随波逐流让生活腐化下去。

「病不是敌人，是善意的提醒。」
我们应该感谢疾病，
而不是痛恨它。

有的人，因为从小身体不好，才去学习了太极拳，后来成为太极拳高手，身心的状态都获得提升。对于他来说，身体不好这件事反而成了他人生中的助力和善缘。

有的人每天晚上出去唱歌，喝酒，参加各种聚会、饭局，然后来找医生看病，说「我失眠了，给我开点药调理吧。」

表面看来，他在积极地求医问药、解决问题，但其实，不论是求助于中医还是西医，都是治标不治本。

因为他的潜台词是：「你来帮我搞定失眠这个问题吧，搞定了我才能继续有精神参加party啊。」他丝毫没有反思自己的生活方式出了问题，也没有改变自己生活方式的愿望。

这种情况下，医生即使有心也无力，孤掌难鸣。只有病人开始反思自己的偏差，再加上医生的帮助，医生和病人完美地配合，才会让一些现象发生改变。这才是疾病作为一个信使存在的意义。

02
有时，你不需要医生

有个人去看病，说他眼睛发胀、视力模糊，已经一周了。医生问他，是不是这一周用电脑、手机太多了？

他才发现，最近一周确实用眼过度了。这时候他根本不需要找医生，尽量不用电脑、手机，休息一两天就能恢复了。而不是去找医生治疗，治好之后继续不知疲倦地看手机、玩游戏。

有个病人最近一周工作压力特别大，晚上应酬也多，经常喝酒，血压很快升高。

这种情况，其实也不需要治疗，他的血压升高是因为他身体的频率与他最近的生活节奏不和谐不平衡。

只要改变这种生活方式，
改变这种不和谐，
血压就会降下来，
不必找医生的。

「大多数高血压或者高血糖之类的病，都是生活方式方面的病。改变生活方式之后，这些问题都可以慢慢消失。」

如同大自然有风霜雨雪，人的身体有疾病也是自然现象，无需恐惧。

「病都只是一种现象，一定不要恐惧这些现象，我们可以透过现象去找背后的本质：

到底是什么导致这个现象、这个问题出现了？怎么去改变它？医生是一个助手，不是一个决定者。

最大的医生是自己的身体，如果身体已经没有了修复能力，医生是无能为力的。」

疾病绝对不是坏事。我们会酸痛，会失眠……都是不同的症状，有着不同的原因。我们去找到这个原因，比直接去消除这个症状，要重要得多。

希望大家不要把所有治病的责任都推给医生，而是跟医生一起商量，怎么找到问题的根源，怎么改变自己不良的心智模式和生活方式。

A心智模式
在我的理念里，中医首先是一个心智模式，就是你怎么看待这个宇宙，这个世界，怎么看待人生。当你的心智模式改变，心态就发生很大的改变，很多精神、思想方面的病就不见了。

B生活方式
第二是生活方式，大部分形体方面的病都是不良的生活方式造成的。

C医疗模式
第三个是医疗模式，属于扶偏救弊，亡羊补牢，是为了补充前两者的不足而存在的。如果有良好的心智模式和生活方式作为基础，医疗模式就变得很轻松。

但现在医疗模式被过于强调，我们对于医生和医院过于依赖，这是非常不正常、不健康的。现在很多病都是越治越多，比如高血压、心脏病、糖尿病，现在的病人比十年前多了多少倍。

越治越多，一方面是环境因素、生活方式的问题，另一方面也说明医疗模式出了问题。

图片

03
什么叫做养生？

就是让身体处于和谐平衡的状态，至于具体的方法，因人、因时、因地而异，没有一套方法是适合所有人的。每个人的需求不一样。

不同的人，根据不同的季节、时辰，根据南北不同的地域，尽量与自然环境和生活环境相和谐地生活，那样就很好了。

「人最终是靠自己的生机和活力生活在宇宙大空间之中。」

医生的作用，其实犹如驱散阴影的阳光，精神上引导患者往最阳光、最温暖、最能安心的状态走，形体上引导他气血的运行、肢体的位置回到和谐状态，帮助患者恢复自愈的本能。

在一个真正的中医眼里，没有「病」这个概念，有的只是每个人身体内部存在的各种不和谐或者不平衡，医生和患者的努力方向是去调整这些不和谐和不平衡。

真正把病治好的，不是对面坐着的那位老中医，不是他用的那根针，不是他的按摩手法，不是我们喝下的那碗汤药，而是我们自己。

各种外治手法也好，各种中药汤剂也好，本质上，其实是一种激发机制，是它激发了人体气机的运行，让身体自我完成治愈修复的过程。

人体有很强的自我修复能力，如果没有这个能力，所有的医生都起不到治疗的作用。


药王孙思邈给所有人看病，首先不是开药，而是看病人这一阶段的生命状态，是意气风发还是失魂落魄，根据不同的状态进行处理；

然后再问病人的饮食起居，各种吃喝拉撒睡，看看病人有哪些不良生活习惯，引导他去建立健康的节奏和习惯；

如果这两招还没搞定，他就给病人一些食疗的方法，再不行就做按摩导引，再不行就扎针，最后才用汤剂。吃药是最后才使用的手段。

疾病是一个现象，这个现象不是单一条件，而是多种条件下产生的。医生治病，其实就是想办法增加条件或者减少条件，那个现象就改变了。

图片

04
不恐惧是非常重要的心法

一个人总是被他的内心打败，而不是外界给他多少伤害。

很多癌症病人的病情恶化，是从他得知自己患癌之后。

其实，肿瘤从潜伏期到转归期有无数种可能，但有的医生喜欢强调最不好的结果，患者听到之后，他的念头和思维就被这个最坏的可能性紧紧抓住，天天在恐惧之中，有时候，成了心理学所说的所谓「自我实现的预言」。

当你相信事情会如你预料的情况发展，你会有意无意地采取加强的措施，最后正是你自己促使了这个预言的实现。


打个比喻：肿瘤，其实相当于房间里的垃圾桶。每个房间都有垃圾桶，暂时储存垃圾。如果一个房间很干净，那是因为有人清洁过、管理过，垃圾桶被及时清空了。

肿瘤，就是身体为了保持整洁而设置的垃圾桶。健康人的身体正气很足，能把体内的垃圾及时清理。但是，当正气不足的时候，我们就没有足够的能力把垃圾清除到体外，身体就会自发地把垃圾暂存到肿瘤这个垃圾桶里面，以免垃圾进入血液。

所以，面对肿瘤，切除肯定不是最好的态度。谁会认为一个房间里垃圾太多了，最好的方法是扔掉垃圾桶呢？经常有病人切除肿瘤之后发现扩散了，其实这是因为你把垃圾桶扔了，当然房间里就会到处是垃圾。

图片

05
如果发现有肿瘤应该怎么办　

首先不要怕，不要慌，问问自己：

我有什么想不开的结在身体里留下了印记？
我有什么没有宣泄的情绪被压在心里？
我有没有不良的生活习惯？

先把心结解开。管理肿块的是阳气，解开心结，节约了阳气，身体就有力量去缩小肿块了。

不恐惧是非常重要的心法，相信癌症是自己的朋友，肿瘤的出现是在提醒自己反观自我，看看自己出了什么问题还不自知。

肿瘤的本质，不过是一个垃圾桶，没什么可怕，它是身体自我保护的产物,不要用激进的、对抗的方式来对待肿瘤。

很多时候，不用肿瘤、癌症这些字眼，换一个词，叫它「肿块」。还是指的同一个东西，但是用肿块这个词，负面的心理暗示就没有那么强了，病人也就没有那么多恐惧。

「恐则气下」，本来正气就弱，恐慌会进一步降低免疫力。人在恐惧之中，整个人是纠结、紧张的。

一定要记住，现代医学经常强调的最坏的结果，只是无数种可能之一。生活方式方面，下面还有三个非常具体的建议：

A离开熟悉的人群
周围的人不断地嘘寒问暖，有时候会给人温暖的能量，有时候却给人增加了压力。对于一个肿瘤患者，亲友们的过度关心会时常提醒他自己是个重病人，反而强化了心理阴影和负能量。

B改变节奏，改变动静阴阳
原来忙忙碌碌、四处奔波的，学一学打坐、站桩，让自己静下来；原来特别宅，不爱出门不爱活动的，多出去旅行，接触不同的山水风景、不同的人，把视野打开。

C调整作息时间，调整饮食
不熬夜，多吃素，让身体内部节律正常、有序。



签到领现金，每日2毛～5毛
可互助，助力码每日不变，只变日期
活动入口：京东APP搜索领现金进入
*/
const $ = new Env('签到领现金');
const notify = $.isNode() ? require('./sendNotify') : '';
//Node.js用户请在jdCookie.js处填写京东ck;
const jdCookieNode = $.isNode() ? require('./jdCookie.js') : '';
let jdNotify = true;//是否关闭通知，false打开通知推送，true关闭通知推送
//IOS等用户直接用NobyDa的jd cookie
let cookiesArr = [], cookie = '', message;
let helpAuthor = true;
const randomCount = $.isNode() ? 20 : 5;
const inviteCodes = [
  `fUl9M7LlLKN4pg@-rmYukAfv3aJ`,
  `fUl9M7LlLKN4pg@-rmYukAfv3aJ`
]
if ($.isNode()) {
  Object.keys(jdCookieNode).forEach((item) => {
    cookiesArr.push(jdCookieNode[item])
  })
  if (process.env.JD_DEBUG && process.env.JD_DEBUG === 'false') console.log = () => {};
} else {
  let cookiesData = $.getdata('CookiesJD') || "[]";
  cookiesData = jsonParse(cookiesData);
  cookiesArr = cookiesData.map(item => item.cookie);
  cookiesArr.reverse();
  cookiesArr.push(...[$.getdata('CookieJD2'), $.getdata('CookieJD')]);
  cookiesArr.reverse();
  cookiesArr = cookiesArr.filter(item => item !== "" && item !== null && item !== undefined);
}
const JD_API_HOST = 'https://api.m.jd.com/client.action';
!(async () => {
  if (!cookiesArr[0]) {
    $.msg($.name, '【提示】请先获取京东账号一cookie\n直接使用NobyDa的京东签到获取', 'https://bean.m.jd.com/bean/signIndex.action', {"open-url": "https://bean.m.jd.com/bean/signIndex.action"});
    return;
  }
  await requireConfig()
  await getAuthorShareCode();
  for (let i = 0; i < cookiesArr.length; i++) {
    if (cookiesArr[i]) {
      cookie = cookiesArr[i];
      $.UserName = decodeURIComponent(cookie.match(/pt_pin=(.+?);/) && cookie.match(/pt_pin=(.+?);/)[1])
      $.index = i + 1;
      $.isLogin = true;
      $.nickName = '';
      message = '';
      await TotalBean();
      console.log(`\n******开始【京东账号${$.index}】${$.nickName || $.UserName}*********\n`);
      if (!$.isLogin) {
        $.msg($.name, `【提示】cookie已失效`, `京东账号${$.index} ${$.nickName || $.UserName}\n请重新登录获取\nhttps://bean.m.jd.com/bean/signIndex.action`, {"open-url": "https://bean.m.jd.com/bean/signIndex.action"});

        if ($.isNode()) {
          await notify.sendNotify(`${$.name}cookie已失效 - ${$.UserName}`, `京东账号${$.index} ${$.UserName}\n请重新登录获取cookie`);
        }
        continue
      }
      await jdCash()
    }
  }
})()
    .catch((e) => {
      $.log('', `❌ ${$.name}, 失败! 原因: ${e}!`, '')
    })
    .finally(() => {
      $.done();
    })
async function jdCash() {
  await index()
  await shareCodesFormat()
  await helpFriends()
  await index(true)
  await getReward()
  await showMsg()
}
function index(info=false) {
  return new Promise((resolve) => {
    $.get(taskUrl("cash_mob_home",), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if(data.code===0 && data.data.result){
              if(info){
                message += `当前现金：${data.data.result.signMoney}`
                return
              }
              console.log(`您的助力码为${data.data.result.inviteCode}`)
              let helpInfo = {
                'inviteCode': data.data.result.inviteCode,
                'shareDate': data.data.result.shareDate
              }
              $.shareDate = data.data.result.shareDate;
              $.log(`shareDate: ${$.shareDate}`)
              // console.log(helpInfo)
              for(let task of data.data.result.taskInfos){
                if (task.type === 4) {
                  for (let i = task.doTimes; i < task.times; ++i) {
                    console.log(`去做${task.name}任务 ${i+1}/${task.times}`)
                    await doTask(task.type, task.jump.params.skuId)
                    await $.wait(5000)
                  }
                }
                else if (task.type === 2) {
                  for (let i = task.doTimes; i < task.times; ++i) {
                    console.log(`去做${task.name}任务 ${i+1}/${task.times}`)
                    await doTask(task.type, task.jump.params.shopId)
                    await $.wait(5000)
                  }
                }
                else if (task.type === 16 || task.type===3 || task.type===5 || task.type===17 || task.type===21) {
                  for (let i = task.doTimes; i < task.times; ++i) {
                    console.log(`去做${task.name}任务 ${i+1}/${task.times}`)
                    await doTask(task.type, task.jump.params.url)
                    await $.wait(5000)
                  }
                }
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
async function helpFriends() {
  $.canHelp = true
  for (let code of $.newShareCodes) {
    console.log(`去帮助好友${code}`)
    await helpFriend(code)
    if(!$.canHelp) break
    await $.wait(1000)
  }
  // if (helpAuthor && $.authorCode) {
  //   for(let helpInfo of $.authorCode){
  //     console.log(`去帮助好友${helpInfo['inviteCode']}`)
  //     await helpFriend(helpInfo)
  //     if(!$.canHelp) break
  //     await $.wait(1000)
  //   }
  // }
}
function helpFriend(helpInfo) {
  return new Promise((resolve) => {
    $.get(taskUrl("cash_mob_assist", {...helpInfo,"source":1}), (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if( data.code === 0 && data.data.bizCode === 0){
              console.log(`助力成功，获得${data.data.result.cashStr}`)
              // console.log(data.data.result.taskInfos)
            } else if (data.data.bizCode===207){
              console.log(data.data.bizMsg)
              $.canHelp = false
            } else{
              console.log(data.data.bizMsg)
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
function doTask(type,taskInfo) {
  return new Promise((resolve) => {
    $.get(taskUrl("cash_doTask",{"type":type,"taskInfo":taskInfo}), (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if( data.code === 0){
              console.log(`任务完成成功`)
              // console.log(data.data.result.taskInfos)
            }else{
              console.log(data)
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
function getReward() {
  return new Promise((resolve) => {
    $.get(taskUrl("cash_mob_reward",{"source":1,"rewardNode":""}), (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if( data.code === 0 && data.data.bizCode === 0 ){
              console.log(`领奖成功，${data.data.result.shareRewardTip}【${data.data.result.shareRewardAmount}】`)
              // console.log(data.data.result.taskInfos)
            }else{
              console.log(`领奖失败，${data.data.bizMsg}`)
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

function showMsg() {
  return new Promise(resolve => {
    if (!jdNotify) {
      $.msg($.name, '', `${message}`);
    } else {
      $.log(`京东账号${$.index}${$.nickName}\n${message}`);
    }
    resolve()
  })
}
getArrRandomly = (arr) => {
    var len = arr.length;
    for (var i = len - 1; i >= 0; i--) {
      var randomIndex = Math.floor(Math.random() * (i + 1));
      var itemIndex = arr[randomIndex];
      arr[randomIndex] = arr[i];
      arr[i] = itemIndex;
    }
    return arr;
  }
  
 
  getRandomArr = (arr=[],num) => {
    const tmpArr = getArrRandomly(arr);
    let arrList = [];
    for (let i = 0; i < num; i++) {
      arrList.push(tmpArr[i]);
    };
    return arrList;
  }


function readShareCode() {
  console.log(`开始读取朱丽娜。。。`)
  return new Promise(async resolve => {
    $.get({url: `https://raw.githubusercontent.com/jd1994527314/iosrule/cs/JD_TG/AS.json`, 'timeout': 10000}, (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (data) {
            console.log(`随机取${randomCount}个码放到您固定的互助码后面(不影响已有固定互助)`)
            data = JSON.parse(data);
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
    await $.wait(10000);
    resolve()
  })
}
//格式化助力码
function shareCodesFormat() {
  return new Promise(async resolve => {
    // console.log(`第${$.index}个京东账号的助力码:::${$.shareCodesArr[$.index - 1]}`)
    $.newShareCodes = [];
    
    const readShareCodeRes = await readShareCode();
    
    if (readShareCodeRes && readShareCodeRes.code === 200) {
$.newShareCodes = [...new Set([...$.newShareCodes, ...(getRandomArr(getArrRandomly(readShareCodeRes.data),randomCount)|| [])])];
    }
    
    console.log(`第${$.index}个京东账号将要助力的好友${JSON.stringify($.newShareCodes)}`)





    resolve();
  })
}

function requireConfig() {
  return new Promise(resolve => {
    console.log(`开始获取${$.name}配置文件\n`);
    let shareCodes = [];
    if ($.isNode()) {
      if (process.env.JD_CASH_SHARECODES) {
        if (process.env.JD_CASH_SHARECODES.indexOf('\n') > -1) {
          shareCodes = process.env.JD_CASH_SHARECODES.split('\n');
        } else {
          shareCodes = process.env.JD_CASH_SHARECODES.split('&');
        }
      }
    }
    console.log(`共${cookiesArr.length}个京东账号\n`);
    $.shareCodesArr = [];
    if ($.isNode()) {
      Object.keys(shareCodes).forEach((item) => {
        if (shareCodes[item]) {
          $.shareCodesArr.push(shareCodes[item])
        }
      })
    }
    console.log(`您提供了${$.shareCodesArr.length}个账号的${$.name}助力码\n`);
    resolve()
  })
}
function deepCopy(obj) {
  let objClone = Array.isArray(obj) ? [] : {};
  if (obj && typeof obj === "object") {
    for (let key in obj) {
      if (obj.hasOwnProperty(key)) {
        //判断ojb子元素是否为对象，如果是，递归复制
        if (obj[key] && typeof obj[key] === "object") {
          objClone[key] = deepCopy(obj[key]);
        } else {
          //如果不是，简单复制
          objClone[key] = obj[key];
        }
      }
    }
  }
  return objClone;
}
function taskUrl(functionId, body = {}) {
  return {
    url: `${JD_API_HOST}?functionId=${functionId}&body=${escape(JSON.stringify(body))}&appid=CashRewardMiniH5Env&appid=9.1.0`,
    headers: {
      'Cookie': cookie,
      'Host': 'api.m.jd.com',
      'Connection': 'keep-alive',
      'Content-Type': 'application/json',
      'Referer': 'http://wq.jd.com/wxapp/pages/hd-interaction/index/index',
      'User-Agent': $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0"),
      'Accept-Language': 'zh-cn',
      'Accept-Encoding': 'gzip, deflate, br',
    }
  }
}

function getAuthorShareCode() {
  return new Promise(resolve => {
    $.get({url: "https://raw.githubusercontent.com/nbzongzong/updateTeam/master/jd_cash.json",headers:{
        "User-Agent": "Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1 Edg/87.0.4280.88"
      }}, async (err, resp, data) => {
      $.authorCode = [];
      try {
        if (err) {
        } else {
          $.authorCode = JSON.parse(data)
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve();
      }
    })
  })
}
function TotalBean() {
  return new Promise(async resolve => {
    const options = {
      "url": `https://wq.jd.com/user/info/QueryJDUserInfo?sceneval=2`,
      "headers": {
        "Accept": "application/json,text/plain, */*",
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "zh-cn",
        "Connection": "keep-alive",
        "Cookie": cookie,
        "Referer": "https://wqs.jd.com/my/jingdou/my.shtml?sceneval=2",
        "User-Agent": $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0")
      }
    }
    $.post(options, (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (data) {
            data = JSON.parse(data);
            if (data['retcode'] === 13) {
              $.isLogin = false; //cookie过期
              return
            }
            $.nickName = data['base'].nickname;
          } else {
            console.log(`京东服务器返回空数据`)
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve();
      }
    })
  })
}
function safeGet(data) {
  try {
    if (typeof JSON.parse(data) == "object") {
      return true;
    }
  } catch (e) {
    console.log(e);
    console.log(`京东服务器访问数据为空，请检查自身设备网络情况`);
    return false;
  }
}
function jsonParse(str) {
  if (typeof str == "string") {
    try {
      return JSON.parse(str);
    } catch (e) {
      console.log(e);
      $.msg($.name, '', '请勿随意在BoxJs输入框修改内容\n建议通过脚本去获取cookie')
      return [];
    }
  }
}
// prettier-ignore
function Env(t,e){class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
