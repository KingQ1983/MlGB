/*
 * @Author: LXK9301 https://github.com/LXK9301
 * @Date: 2020-11-01 16:25:41
 * @Last Modified by:   LXK9301
 * @Last Modified time: 2020-12-22 10:25:41
 */
/*
TED演讲：爱吃烧烤又担心不健康？这样吃！
文章来源：未知 文章作者：enread 发布时间：2020-07-08 12:00 字体： [大 中 小]　 进入论坛
(单词翻译:双击或拖选)
演讲者： 劳伦·霍奇、史丽·博斯和娜奥米·沙赫

Lauren Hodge: If you were going to a restaurant and wanted a healthier option, which would you choose, grilled or fried chicken? Now most people would answer grilled, and it's true that grilled chicken does contain less fat and fewer calories. However, grilled chicken poses a hidden danger. The hidden danger is heterocyclic amines -- specifically phenomethylimidazopyridine, or PhIP -- (laughter) which is the immunogenic or carcinogenic compound.
劳伦·霍奇:如果你去饭店，你想吃得健康一点，你会选择哪种食品呢，烤鸡还是炸鸡？多数人都会选择烤鸡，的确，烤鸡含有较少的脂肪和卡路里。但是，烤鸡存在一个潜在的危险，这个潜在的危险是多环胺类——具体的来讲，是phenomethylimidazopyridine, 或者简称为PhIP——是免疫原性或致癌物质的成分。
 
A carcinogen is any substance or agent that causes abnormal growth of cells, which can also cause them to metastasize or spread. They are also organic compounds in which one or more of the hydrogens in ammonia is replaced with a more complex group. Studies show that antioxidants are known to decrease these heterocyclic amines.
致癌物质是任何会导致细胞的异常增长，也会导致细胞的转移和扩张的介质。它们也是有机物氨中的一个或多个氢被替换成更复杂的组成，研究显示抗氧化剂能减少这些杂胺环。
 
However, no studies exist yet that show how or why. These here are five different organizations that classify carcinogens. And as you can see, none of the organizations consider the compounds to be safe, which justifies the need to decrease them in our diet. Now you might wonder how a 13 year-old girl could come up with this idea. And I was led to it through a series of events.
但是，现在还没有研究显示通过如何方式或者为什么。这是五个不同的组织对致癌物的分类。如同你所看到的，没有任何一个组织认为该组成物是安全的，就是说我们需要在饮食中减少对它们的摄入。现在你可能会问一个13岁的女孩怎么会想到这一点。是一系列的事件将我引导至此的。
 
I first learned about it through a lawsuit I read about in my doctor's office -- which was between the Physician's Committee for Responsible Medicine and seven different fast food restaurants. They weren't sued because there was carcinogens in the chicken, but they were sued because of California's Proposition 65, which stated that if there's anything dangerous in the products then the companies had to give a clear warning.
首先，是我在医生那里听到的一个诉讼案——是关于责任医学委员会和七个不同的快餐店之间的诉讼。快餐店被告并不是因为在鸡肉中有致癌物质，而是因为加利福尼亚州65号提案，提案要求如果产品中有任何有害成分，公司应该给出明确的警告。
 
So I was very surprised about this. And I was wondering why nobody knew more about this dangerous grilled chicken, which doesn't seem very harmful. But then one night, my mom was cooking grilled chicken for dinner, and I noticed that the edges of the chicken, which had been marinated in lemon juice, turned white.
我对此很惊讶，我很奇怪为什么没有人知道有害烤鸡，虽然它们看起来不那么有害。但是一天晚上，晚餐时我妈妈在烤鸡，我注意到鸡肉的边缘，经过柠檬汁的浸泡，变白了。
 
And later in biology class, I learned that it's due to a process called denaturing, which is where the proteins will change shape and lose their ability to chemically function. So I combined these two ideas and I formulated a hypothesis, saying that, could possibly the carcinogens be decreased due to a marinade and could it be due to the differences in PH?
后来在生物课上，我学到这是由于一种叫变性的过程，就是蛋白质会改变形态，失去它们化学性功能。所以，我将两种想法综合在一起，创造了一个假说，那就是，因为酸碱度的改变，致癌物很可能因为腌泡汁的浸泡而降低？
 
So my idea was born, and I had the project set up and a hypothesis, so what was my next step? Well obviously I had to find a lab to work at because I didn't have the equipment in my school. I thought this would be easy, but I emailed about 200 different people within a five-hour radius of where I lived, and I got one positive response that said that they could work with me.
这就是我的想法诞生的过程，然后，我就有了项目的开展和假说，那么我的下一步呢？很明显的，我要找到一家实验室，因为我在学校没有实验设备。我以为这会很容易，但是我给200多个人写邮件，那些人离我居住的地方开车5个小时的范围内，我只得到了一个正面的回复，说愿意帮助我。
 
Most of the others either never responded back, said they didn't have the time or didn't have the equipment and couldn't help me. So it was a big commitment to drive to the lab to work multiple times. However, it was a great opportunity to work in a real lab -- so I could finally start my project.
更多的人要么根本不回复，说他们没时间，要么就是没有设备，帮不了我。所以说，这是一个很重的承诺，要多次开车去实验室开展实验。但是，这是一个可以在真正的实验室工作的绝好机会——我也得以最终开始我的项目。
 
The first stage was completed at home, which consisted of marinating the chicken, grilling the chicken, amassing it and preparing it to be transported to the lab. The second stage was completed at the Penn State University main campus lab, which is where I extracted the chemicals, changed the PH so I could run it through the equipment and separated the compounds I needed from the rest of the chicken.
第一步是完全在家完成的，其中包括腌制鸡肉，烤鸡，收集样本以及准备送到实验室。第二步的完成是在宾州大的主校园实验室，也就是我提取化学物质的地方，改变酸碱度，这样我就可以通过设备从其余的鸡肉中分离我所需的成分。
 
The final stages, when I ran the samples through a high-pressure liquid chromatography mass spectrometer, which separated the compounds and analyzed the chemicals and told me exactly how much carcinogens I had in my chicken. So when I went through the data, I had very surprising results, because I found that four out of the five marinating ingredients actually inhibited the carcinogen formation.
最后一步是，当我把样本经过高压液相色谱质谱仪，分开混和物质，并且分析其中的化学物质，于是我能很准确得知道在鸡肉中有多少致癌物。当分析数据时，我发现了很惊人的结果，因为我发现五种腌制调料中有四种实际上能阻止致癌物的组成。
 
When compared with the unmarinated chicken, which is what I used as my control, I found that lemon juice worked by far the best, which decreased the carcinogens by about 98 percent. The saltwater marinade and the brown sugar marinade also worked very well, decreasing the carcinogens by about 60 percent.
当同没有经过腌制的鸡肉比较时，也就是我的控制样本，我发现柠檬汁目前是最有效的，能降低致癌物达98%。盐水腌制和红糖腌制也同样有效，能降低致癌物达60%。
 
Olive oil slightly decreased the PhIP formation, but it was nearly negligible. And the soy sauce results were inconclusive because of the large data range, but it seems like soy sauce actually increased the potential carcinogens.
 
橄榄油只能轻微的降低PhIP的组成，但是几乎是微不足道的。酱油的实验结果还是未知数。这是由于广泛的数据范围，但是看上去酱油实际上增加了潜在的致癌物。
 
Another important factor that I didn't take into account initially was the time cooked. And I found that if you increase the time cooked, the amount of carcinogens rapidly increases. So the best way to marinate chicken, based on this, is to, not under-cook, but definitely don't over-cook and char the chicken, and marinate in either lemon juice, brown sugar or saltwater.
另一个我没有事先预计在内的重要因素就是烧烤时间。我发现如果增加烧烤时间，致癌物将飞速的增长，所以最好的腌制方式，根据这些（实验结果）也就是，不要生煮，但是一定不要煮过头和烤过头，用柠檬汁，红糖或者盐水来腌制。
 
Based on these findings, I have a question for you. Would you be willing to make a simple change in your diet that could potentially save your life? Now I'm not saying that if you eat grilled chicken that's not marinated, you're definitely going to catch cancer and die. However, anything you can do to decrease the risk of potential carcinogens can definitely increase the quality of lifestyle.
根据这些发现，我有个问题想问你们。你们会愿意在你的饮食上做个简单的改变，由此可能会拯救你的生命？我并不是说如果你吃没有经过腌制的烤鸡，你就一定会得癌症然后死去。但是，你所做的任何事情来降低潜在致癌物质的几率，就一定会增加你生活方式的质量。
 
Is it worth it to you? How will you cook your chicken now?
对你来说，这值得吗? 现在你会怎么做鸡肉呢？
 
Shree Bose: Hi everyone. I'm Shree Bose. I was the 17-18 year-old age category winner and then the grand prize winner. And I want all of you to imagine a little girl holding a dead blue spinach plant. And she's standing in front of you and she's explaining to you that little kids will eat their vegetables if they're different colors. Sounds ridiculous, right.
斯里·波色: 大家好，我是斯里·波色。我是17-18岁组的冠军，也是大奖得主。我希望大家能想象一个小女孩拿着一个死亡的蓝色菠菜。她就站在你面前，向你解释其实小孩是会愿意吃蔬菜的，如果它们的颜色变得不同的话。这挺起来很不可思议，是吧。
 
But that was me years ago. And that was my first science fair project. It got a bit more complicated from there. My older brother Panaki Bose spent hours of his time explaining atoms to me when I barely understood basic algebra. My parents suffered through many more of my science fair projects, including a remote controlled garbage can.
但这是几年前的我，那是我第一个科学展项目。从那以后就变得复杂了。我的哥哥帕纳吉·波色花了很多时间跟我解释原子，当我还对基本代数没什么概念的时候。我的科学展项目给我的父母带来了很多困扰，包括了一个遥控移动垃圾箱。
 
And then came the summer after my freshman year, when my grandfather passed away due to cancer. And I remember watching my family go through that and thinking that I never wanted another family to feel that kind of loss. So, armed with all the wisdom of freshman year biology, I decided I wanted to do cancer research at 15.
然后就迎来了我高一的暑假，也是我爷爷因为癌症去世的时候。我记得看着家人们承受这些痛苦，想着我永远都不要别的家庭也经受这种失去。所以，我用高一生物知识把自己武装起来，在我15岁的时候，我决定研究癌症。
 
Good plan. So I started emailing all of these professors in my area asking to work under their supervision in a lab. Got rejected by all except one. And then went on, my next summer, to work under Dr. Basu at the UNT Health Center at Fort Worth, Texas. And that is where the research began.
这是个很棒的计划。所以，我开始向这个领域的所有教授写信，询问能否在他们的监督下在实验室工作。除了一位，其它的全都拒绝了我。就这样，在第二个暑假，在位于得克萨斯州华兹堡市的UNT健康中心，我开始了在巴苏博士的指导下工作。这就是研究的开始。
 
So ovarian cancer is one of those cancers that most people don't know about, or at least don't pay that much attention to. But yet, it's the fifth leading cause of cancer deaths among women in the United States. In fact, one in 70 women will be diagnosed with ovarian cancer. One in 100 will die from it.
卵巢癌是大多数人所不了解的癌症之一，或者至少说没有怎么注意。但是，它是导致全美女性 死亡的第五大癌症。实际上，在70位女性中就有一位会被确诊为卵巢癌，在100位中就有一位会因此而死亡。
 
Chemotherapy, one of the most effective ways used to treat cancer today, involves giving patients really high doses of chemicals to try and kill off cancer cells. Cisplatin is a relatively common ovarian cancer chemotherapy drug -- a relatively simple molecule made in the lab that messes with the DNA of cancer cells and causes them to kill themselves. Sounds great, right?
顺铂是较常见的一种治疗卵巢癌的药——在实验室中能合成的较简单的分子，它能够捣毁癌症细胞的DNA，促使它们杀死它们自己。挺起来很棒，是吧？化疗，是现今治疗癌症最有效的方式之一，包括给病患者高剂量的化学物质，意图杀死癌症细胞。
 
But here's the problem: sometimes patients become resistant to the drug, and then years after they've been declared to be cancer free, they come back. And this time, they no longer respond to the drug. It's a huge problem. In fact, it's one of the biggest problems with chemotherapy today.
但是有个问题: 有些时候，病人们会对药产生抗药性，许多年后，在癌症被除去之后又重新患上。但是这次，病人们不会再对药物产生反应。这是个大问题。实际上，这是现今化疗所面临的最大的问题之一。
 
So we wanted to figure out how these ovarian cancer cells are becoming resistant to this drug called Cisplatin. And we wanted to figure this out, because if we could figure that out, then we might be able to prevent that resistance from ever happening. So that's what we set out to do. And we thought it had something to do with this protein called AMP kinase, an energy protein.
我们想清楚的是卵巢癌细胞是如何对这种叫顺铂的药产生抗药性。我们之所以想知道这个，是因为如果我们把这个搞清楚了，我们可能可以预防抗药性的发生。所以这就是我们要做的。我们认为跟一种叫做AMP的激酶蛋白有关，一种能量蛋白。
 
So we ran all of these tests blocking the protein, and we saw this huge shift. I mean, on the slide, you can see that on our sensitive side, these cells that are responding to the drug, when we start blocking the protein, the number of dying cells -- those colored dots -- they're going down. But then on this side, with the same treatment, they're going up -- interesting.
我们进行了很多实验来阻止这种蛋白，我们发现了巨大的改变。我的意思是，在幻灯片上，你可以看到在我们敏感细胞里，这些对药产生反应的细胞，当我们开始阻止这种蛋白，死亡细胞的数量，这些有颜色的点开始下降。但是，在这边，同样的治疗方式，数量在上升，真有趣。
 
But those are dots on a screen for you; what exactly does that mean? Well basically that means that this protein is changing from the sensitive cell to the resistant cell. And in fact, it might be changing the cells themselves to make the cells resistant. And that's huge. In fact, it means that if a patient comes in and they're resistant to this drug, then if we give them a chemical to block this protein, then we can treat them again with the same drug.
但是那些你们看起来是屏幕上的点；到底有什么意义呢？基本上，这意味着这种蛋白在改变，从敏感细胞变为抵抗性细胞。实际上，可能是细胞自身在改变让细胞自己变得具有抵抗性。它们有着巨大的抵抗力。实际上，这意味着如果病人他们对这种药产生抗药性，如果我们给他们这种化学物质来阻止这种蛋白，那么我们又可以用同样的药重新治疗他们。
 
And that's huge for chemotherapy effectiveness -- possibly for many different types of cancer. So that was my work, and it was my way of reimagining the future for future research, with figuring out exactly what this protein does, but also for the future of chemotherapy effectiveness -- so maybe all grandfathers with cancer have a little bit more time to spend with their grandchildren.
对于化疗的有效性来说这是巨大的改变，很可能对多种不同的癌症有效。这就是我的工作，这就是我对未来的畅想，要弄清楚这种蛋白到底是什么，同时也是化疗有效性的未来，或许所有患有癌症的爷爷都能有更多的时间跟他们的孙子辈们在一起。
 
But my work wasn't just about the research. It was about finding my passion. That's why being the grand prize winner of the Google Global Science Fair -- cute picture, right -- it was so exciting to me and it was such an amazing honor. And ever since then, I've gotten to do some pretty cool stuff -- from getting to meet the president to getting to be on this stage to talk to all of you guys.
但是，我的工作并不仅仅是研究，还包括寻找我的梦想所在，那就是我为什么会成为谷歌科技展大奖的得主，很漂亮的照片，是吧，对于我来说是无比的兴奋，无比的荣耀。从那以后，我能开始做很多很酷的东西，从能够见到总统到能站在这个演讲台上跟大家讲话。
 
But like I said, my journey wasn't just about the research, it was about finding my passion, and it was about making my own opportunities when I didn't even know what I was doing. It was about inspiration and determination and never giving up on my interest for science and learning and growing. After all, my story begins with a dried, withered spinach plant and it's only getting better from there.
但是就像我说过的，我的旅行并不仅仅是关于研究，也是关于我的梦想，当我都还不知道我在做什么的时候我如何制造机会，这就是灵感和决心以及从不放弃我对自然科学，学习，以及成长的兴趣。不管怎样，我的故事始于一颗干枯的，凋萎的菠菜，从那以后就开始变得越来越好。
 
Thank you.
谢谢大家
 
Naomi Shah: Hi everyone. I'm Naomi Shah, and today I'll be talking to you about my research involving indoor air quality and asthmatic patients. 1.6 million deaths worldwide. One death every 20 seconds. People spend over 90 percent of their lives indoors. And the economic burden of asthma exceeds that of HIV and tuberculosis combined.
劳伦·霍奇:大家好，我是劳伦·霍奇，今天我要跟你们讲讲我关于室内空气质量的研究和在世界范围内有160万的哮喘病人。每20秒就有一例死亡。人们90%的生活都在室内，哮喘带来的经济负担超过了HIV和肺结核的总合。
 
Now these statistics had a huge impact on me, but what really sparked my interest in my research was watching both my dad and my brother suffer from chronic allergies year-round. It confused me; why did these allergy symptoms persist well past the pollen season?
这些统计数据对我产生了重大的影响，但是，真正点燃我研究兴趣的是看到我爸爸和弟弟受到全年慢性过敏的困扰，这让我很困惑；为什么这些过敏症状在花粉季节这么顽固？
 
With this question in mind, I started researching, and I soon found that indoor air pollutants were the culprit. As soon as I realized this, I investigated the underlying relationship between four prevalent air pollutants and their affect on the lung health of asthmatic patients. At first, I just wanted to figure out which of these four pollutants have the largest negative health impact on the lung health of asthmatic patients.
带着这个问题，我开始了研究，我很快发现室内空气污染物是罪魁祸首。我一发现这一点，就调查了四种广布的空气污染物的关系，和他们对哮喘病人肺部健康的影响。起初，我只是想弄清楚，这四种污染物中哪一种对于哮喘病人的肺部健康来说是最有害的。
 
But soon after, I developed a novel mathematical model that essentially quantifies the effect of these environmental pollutants on the lung health of asthmatic patients. And it surprises me that no model currently exists that quantifies the effect of environmental factors on human lung health, because that relationship seems so important.
但是很快，我建立了一个新型的数学模型，从本质上量化了这些环境污染物对哮喘病人肺部健康的影响。让我惊奇的是，目前还没有模型能量化环境因素对人类肺部健康的影响，因为这之间的关系看起来很重要。
 
So with that in mind, I started researching more, I started investigating more, and I became very passionate. Because I realized that if we could find a way to target remediation, we could also find a way to treat asthmatic patients more effectively. For example, volatile organic compounds are chemical pollutants that are found in our schools, homes and workplaces. They're everywhere.
带着这种想法，我开始了更多的研究，更多的调查，变得激情澎湃。因为，我发现如果我们能找到一个整治环境的方法，我们也能找到一种方法来更有效的治疗哮喘病人。比如，挥发性有机物是化学性污染物，在我们的学校，家里以及办公室都能发现它们。它们无处不在。
 
These chemical pollutants are currently not a criteria air pollutant, as defined by the U.S. Clean Air Act. Which is surprising to me, because these chemical pollutants, through my research, I show that they had a very large negative impact on the lung health of asthmatic patients and thus should be regulated.
这些化学污染物据美国清洁空气法案定义，目前还不在空气污染物的标准中。这让我感到惊奇，因为这些化学污染物，根据我的研究，我发现他们对哮喘病人的健康有极其负面的影响，因此应该被列入规范中。
 
So today I want to show you my interactive software model that I created. I'm going to show it to you on my laptop. And I have a volunteer subject in the audience today, Julie. And all of Julie's data has been pre-entered into my interactive software model. And this can be used by anyone. So I want you to imagine that you're in Julie's shoes, or someone who's really close to you who suffers from asthma or another lung disorder.
所以今天我想向你们展示我创造的互动软件。我将用我的笔记本电脑向大家展示。在今天的观众中，我有一个志愿者朱莉，朱莉的所有数据都被事先输入进我的交互软件模型中。这个模型可以用在任何人身上。现在我希望大家以朱莉的身份来想象，或者跟你最亲近患有哮喘病或者其他肺部疾病的人。
 
So Julie's going to her doctor's office to get treated for her asthma. And the doctor has her sit down, and he takes her peak expiratory flow rate -- which is essentially her exhalation rate, or the amount of air that she can breathe out in one breath.
朱莉现在去看医生，去治疗她的哮喘，医生请她坐下，给她测了呼气流量率峰值，实际上就是她的呼气率，或者说是她一口气所呼出的空气量。
 
So that peak expiratory flow rate, I've entered it up into the interactive software model. I've also entered in her age, her gender and her height. I've assumed that she lives in an average household with average air pollutant levels. So any user can come in here and click on "lung function report" and it'll take them to this report that I created. And this report really drives home the crux of my research.
所以说呼气流量率峰值，我把这个值输入交互软件模型中。我也输入了她的年龄，性别和身高。我还假设她住在一个普通环境，处于普通的空气污染程度。任何用户可以用这个软件，点击“肺部功能报告” 它就能告诉他们我发明的这个报告。这个报告真真切切的促进了我研究中的症结。
 
So what it shows -- if you want to focus on that top graph in the right-hand corner -- it shows Julie's actual peak expiratory flow rate in the yellow bar. This is the measurement that she took in her doctor's office. In the blue bar at the bottom of the graph, it shows what her peak expiratory flow rate, what her exhalation rate or lung health, should be based on her age, gender and height. So the doctor sees this difference between the yellow bar and the blue bar, and he says, "Wow, we need to give her steroids, medication and inhalers."
它显示出，如果你只想关注右上角的图示，它显示出朱莉的实际呼气流量率峰值，就是那个黄色方块。这个是她在医生那里的测量值，在图示下方的蓝色方块，显示了她的呼气流量率峰值，她的析出率或者肺部健康，应该是根据她的年龄，性别和身高分析得出的。所以当医生看到黄色方块和蓝色方块的区别，他会说，“哇，我们应该给她类固醇，药品和气管喷雾。”
 
But I want everyone here to reimagine a world where instead of prescribing steroids, inhalers and medication, the doctor turns to Julie and says, "Why don't you go home and clean out your air filters. Clean out the air ducts in your home, in your workplace, in your school. Stop the use of incense and candles. And if you're remodeling your house, take out all the carpeting and put in hardwood flooring."
我希望大家重新想象一下一个世界，一个没有处方类固醇，气管喷雾和药品，医生会对朱莉说，“为什么你不回家清理一下你家的空气过滤器呢？清扫你家的灰尘，在你办公室以及你学校的灰尘。不要用熏香和蜡烛。如果你要重新装修你家，把所有的地毯都撤掉，换成木地板吧。”
 
Because these solutions are natural, these solutions are sustainable, and these solutions are long-term investments -- long-term investments that we're making for our generation and for future generations. Because these environmental solutions that Julie can make in her home, her workplace and her school are impacting everyone that lives around her.
因为这些解决方法都是天然的，这些解决方法都是可持续的，这些解决方法是种长期的投资。我们为了我们这一代人以及未来的人做的长期投资。因为这些环境的解决方法。这些朱莉在她的家，她的工作室和她的学校就可以实施的解决方法。对生活在他周围的每一个人产生了影响。
 
So I'm very passionate about this research and I really want to continue it and expand it to more disorders besides asthma, more respiratory disorders, as well as more pollutants. But before I end my talk today, I want to leave you with one saying. And that saying is that genetics loads the gun, but the environment pulls the trigger.
所以我对这项研究很感兴趣，我非常希望能够继续研究，将它扩展到研究除了哮喘病之外的更多的疾病，更多的呼吸系统疾病以及更多的污染物。在我结束今天的讲话之前，我想以一句话结束，这句话就是遗传学将子弹装上，但是环境扣下扳机。
 
And that made a huge impact on me when I was doing this research. Because what I feel, is a lot of us think that the environment is at a macro level, that we can't do anything to change our air quality or to change the climate or anything.
当我在进行研究的时候，那对我产生了巨大的影响。因为我感觉到的是，我们很多人都认为环境是一个很大的范围，对于改变空气质量我们做不了什么，也无法改变气候或者其他任何事。
 
But if each one of us takes initiative in our own home, in our own school and in our own workplace, we can make a huge difference in air quality. Because remember, we spend 90 percent of our lives indoors. And air quality and air pollutants have a huge impact on the lung health of asthmatic patients, anyone with a respiratory disorder and really all of us in general.
但是如果我们每个人在我们自己家里行动起来，在我们的学校，我们的办公室，我们能极大得改变空气质量。因为，请记住，我们百分之九十的生活都是在室内，空气质量和空气污染物对哮喘病人的肺部健康有巨大的影响，这不止是对那些患有呼吸系统紊乱的人，还有对我们所有人而言都一样。
 
So I want you to reimagine a world with better air quality, better quality of life and better quality of living for everyone including our future generations.
因此，我希望你们为每个人，包括我们的后代，重新构建一个空气质量更好、生活质量更好的世界。
 
Thank you.
谢谢。变动通知脚本：https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bean_change.js
统计昨日京豆的变化情况，包括收入，支出，以及显示当前京豆数量,目前小问题:下单使用京豆后,退款重新购买会出现异常
网页查看地址 : https://bean.m.jd.com/beanDetail/index.action?resourceValue=bean
支持京东双账号
脚本兼容: QuantumultX, Surge, Loon, JSBox, Node.js
============QuantumultX==============
[task_local]
#京豆变动通知
2 9 * * * https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bean_change.js, tag=京豆变动通知, img-url=https://raw.githubusercontent.com/Orz-3/task/master/jd.png, enabled=true
================Loon===============
[Script]
cron "2 9 * * *" script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bean_change.js, tag=京豆变动通知
=============Surge===========
[Script]
京豆变动通知 = type=cron,cronexp=2 9 * * *,wake-system=1,timeout=3600,script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bean_change.js

============小火箭=========
京豆变动通知 = type=cron,script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bean_change.js, cronexpr="2 9 * * *", timeout=3600, enable=true
 */
const $ = new Env('京豆变动通知');
const notify = $.isNode() ? require('./sendNotify') : '';
//Node.js用户请在jdCookie.js处填写京东ck;
const jdCookieNode = $.isNode() ? require('./jdCookie.js') : '';

//IOS等用户直接用NobyDa的jd cookie
let cookiesArr = [], cookie = '';
if ($.isNode()) {
  Object.keys(jdCookieNode).forEach((item) => {
    cookiesArr.push(jdCookieNode[item])
  })
  if (process.env.JD_DEBUG && process.env.JD_DEBUG === 'false') console.log = () => {};
} else {
  let cookiesData = $.getdata('CookiesJD') || "[]";
  cookiesData = jsonParse(cookiesData);
  cookiesArr = cookiesData.map(item => item.cookie);
  cookiesArr.reverse();
  cookiesArr.push(...[$.getdata('CookieJD2'), $.getdata('CookieJD')]);
  cookiesArr.reverse();
  cookiesArr = cookiesArr.filter(item => item !== "" && item !== null && item !== undefined);
}
!(async () => {
  if (!cookiesArr[0]) {
    $.msg($.name, '【提示】请先获取京东账号一cookie\n直接使用NobyDa的京东签到获取', 'https://bean.m.jd.com/bean/signIndex.action', {"open-url": "https://bean.m.jd.com/bean/signIndex.action"});
    return;
  }
  for (let i = 0; i < cookiesArr.length; i++) {
    if (cookiesArr[i]) {
      cookie = cookiesArr[i];
      $.UserName = decodeURIComponent(cookie.match(/pt_pin=(.+?);/) && cookie.match(/pt_pin=(.+?);/)[1])
      $.index = i + 1;
      $.beanCount = 0;
      $.incomeBean = 0;
      $.expenseBean = 0;
      $.errorMsg = '';
      $.isLogin = true;
      $.nickName = '';
      $.message = '';
      await TotalBean();
      console.log(`\n开始【京东账号${$.index}】${$.nickName || $.UserName}\n`);
      if (!$.isLogin) {
        $.msg($.name, `【提示】cookie已失效`, `京东账号${$.index} ${$.nickName || $.UserName}\n请重新登录获取\nhttps://bean.m.jd.com/bean/signIndex.action`, {"open-url": "https://bean.m.jd.com/bean/signIndex.action"});

        if ($.isNode()) {
          await notify.sendNotify(`${$.name}cookie已失效 - ${$.UserName}`, `京东账号${$.index} ${$.UserName}\n请重新登录获取cookie`);
        }
        continue
      }
      await bean();
      await showMsg();
    }
  }
})()
    .catch((e) => {
      $.log('', `❌ ${$.name}, 失败! 原因: ${e}!`, '')
    })
    .finally(() => {
      $.done();
    })
async function showMsg() {
  if ($.errorMsg) return
  if ($.isNode()) {
    await notify.sendNotify(`${$.name} - 账号${$.index} - ${$.nickName}`, `账号${$.index}：${$.nickName || $.UserName}\n昨日收入：${$.incomeBean}京豆 🐶\n昨日支出：${$.expenseBean}京豆 🐶\n当前京豆：${$.beanCount}京豆 🐶${$.message}`, { url: `https://bean.m.jd.com/beanDetail/index.action?resourceValue=bean` })
  }
  $.msg($.name, '', `账号${$.index}：${$.nickName || $.UserName}\n昨日收入：${$.incomeBean}京豆 🐶\n昨日支出：${$.expenseBean}京豆 🐶\n当前京豆：${$.beanCount}京豆 🐶${$.message}`, {"open-url": "https://bean.m.jd.com/beanDetail/index.action?resourceValue=bean"});
}
async function bean() {
  // console.log(`北京时间零点时间戳:${parseInt((Date.now() + 28800000) / 86400000) * 86400000 - 28800000}`);
  // console.log(`北京时间2020-10-28 06:16:05::${new Date("2020/10/28 06:16:05+08:00").getTime()}`)
  // 不管哪个时区。得到都是当前时刻北京时间的时间戳 new Date().getTime() + new Date().getTimezoneOffset()*60*1000 + 8*60*60*1000

  //前一天的0:0:0时间戳
  const tm = parseInt((Date.now() + 28800000) / 86400000) * 86400000 - 28800000 - (24 * 60 * 60 * 1000);
  // 今天0:0:0时间戳
  const tm1 = parseInt((Date.now() + 28800000) / 86400000) * 86400000 - 28800000;
  let page = 1, t = 0, yesterdayArr = [];
  do {
    let response = await getJingBeanBalanceDetail(page);
    console.log(`第${page}页: ${JSON.stringify(response)}`);
    if (response && response.code === "0") {
      page++;
      let detailList = response.detailList;
      if (detailList && detailList.length > 0) {
        for (let item of detailList) {
          const date = item.date.replace(/-/g, '/') + "+08:00";
          if (tm <= new Date(date).getTime() && new Date(date).getTime() < tm1) {
            //昨日的
            yesterdayArr.push(item);
          } else if (tm > new Date(date).getTime()) {
            //前天的
            t = 1;
            break;
          }
        }
      } else {
        $.errorMsg = `数据异常`;
        $.msg($.name, ``, `账号${$.index}：${$.nickName}\n${$.errorMsg}`);
        t = 1;
      }
    }
  } while (t === 0);
  for (let item of yesterdayArr) {
    if (Number(item.amount) > 0) {
      $.incomeBean += Number(item.amount);
    } else if (Number(item.amount) < 0) {
      $.expenseBean += Number(item.amount);
    }
  }
  await queryexpirejingdou();
  // console.log(`昨日收入：${$.incomeBean}个京豆 🐶`);
  // console.log(`昨日支出：${$.expenseBean}个京豆 🐶`)
}
function TotalBean() {
  return new Promise(async resolve => {
    const options = {
      "url": `https://wq.jd.com/user/info/QueryJDUserInfo?sceneval=2`,
      "headers": {
        "Accept": "application/json,text/plain, */*",
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "zh-cn",
        "Connection": "keep-alive",
        "Cookie": cookie,
        "Referer": "https://wqs.jd.com/my/jingdou/my.shtml?sceneval=2",
        "User-Agent": $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0")
      }
    }
    $.post(options, (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (data) {
            data = JSON.parse(data);
            if (data['retcode'] === 13) {
              $.isLogin = false; //cookie过期
              return
            }
            $.nickName = data['base'].nickname;
            if (data['retcode'] === 0) {
              $.beanCount = data['base'].jdNum;
            }
          } else {
            console.log(`京东服务器返回空数据`)
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
function getJingBeanBalanceDetail(page) {
  return new Promise(async resolve => {
    const options = {
      "url": `https://api.m.jd.com/client.action?functionId=getJingBeanBalanceDetail`,
      "body": `body=${escape(JSON.stringify({"pageSize": "20", "page": page.toString()}))}&appid=ld`,
      "headers": {
        'User-Agent': $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0"),
        'Host': 'api.m.jd.com',
        'Content-Type': 'application/x-www-form-urlencoded',
        'Cookie': cookie,
      }
    }
    $.post(options, (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (data) {
            data = JSON.parse(data);
            // console.log(data)
          } else {
            console.log(`京东服务器返回空数据`)
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
function queryexpirejingdou() {
  return new Promise(async resolve => {
    const options = {
      "url": `https://wq.jd.com/activep3/singjd/queryexpirejingdou?_=${Date.now()}&g_login_type=1&sceneval=2`,
      "headers": {
        "Accept": "*/*",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "zh-cn",
        "Connection": "keep-alive",
        "Cookie": cookie,
        "Host": "wq.jd.com",
        "Referer": "https://wqs.jd.com/promote/201801/bean/mybean.html",
        "User-Agent": "Mozilla/5.0 (iPhone; CPU iPhone OS 14_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.1 Mobile/15E148 Safari/604.1"
      }
    }
    $.get(options, (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} API请求失败，请检查网路重试`)
        } else {
          if (data) {
            console.log(data)
            data = JSON.parse(data.slice(23, -13));
            // console.log(data)
            if (data.ret === 0) {
              const expirejingdou = data['expirejingdou'][0]['expireamount'];
              if (expirejingdou > 0) {
                $.message += `\n今日将过期：${expirejingdou}京豆 🐶`;
              }
            }
          } else {
            console.log(`京东服务器返回空数据`)
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve();
      }
    })
  })
}
function jsonParse(str) {
  if (typeof str == "string") {
    try {
      return JSON.parse(str);
    } catch (e) {
      console.log(e);
      $.msg($.name, '', '请勿随意在BoxJs输入框修改内容\n建议通过脚本去获取cookie')
      return [];
    }
  }
}
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============📣系统通知📣=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`❗️${this.name}, 错误!`,t.stack):this.log("",`❗️${this.name}, 错误!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${s} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
