/*
è‹±è¯­æ¼”è®²ï¼šæ”¹å˜ä¸€ä¸‹ï¼Œä»°æœ›æ˜Ÿç©º
æ–‡ç« æ¥æºï¼šæœªçŸ¥ æ–‡ç« ä½œè€…ï¼šenread å‘å¸ƒæ—¶é—´ï¼š2020-05-11 07:03 å­—ä½“ï¼š [å¤§ ä¸­ å°]ã€€ è¿›å…¥è®ºå›
(å•è¯ç¿»è¯‘:åŒå‡»æˆ–æ‹–é€‰)
The sky is inherently democratic.
å¤œç©ºï¼Œæ˜¯äººç±»ä¸ç”Ÿä¿±æ¥çš„å…±äº«èµ„æºã€‚
It's accessible, in principle, anyway, by anyone, everywhere, just simply by the act of looking up.
åŸåˆ™ä¸Šæ¥è¯´ï¼Œä»»ä½•äººã€åœ¨ä»»ä½•åœ°æ–¹ï¼Œéƒ½å¯ä»¥æ¬£èµå¤œç©ºçš„ç¾ï¼Œä½ åªéœ€è½»è½»æŠ¬å¤´ä»°æœ›ã€‚
But like so many beautiful things around us, it's slipping away from us,
ç„¶è€Œï¼Œå¦‚åŒæˆ‘ä»¬èº«è¾¹å¾ˆå¤šå…¶å®ƒç¾ä¸½çš„äº‹ç‰©ä¸€æ ·ï¼Œå¤œç©ºæ­£åœ¨é€æ¸æ¶ˆé€ï¼Œ
and we haven't even noticed, because we're honestly not really looking.
è€Œæˆ‘ä»¬å´æœªæ›¾å¯Ÿè§‰ï¼Œå› ä¸ºï¼Œæˆ‘ä»¬æ ¹æœ¬çœ‹éƒ½æ²¡çœ‹ä¸€çœ¼ã€‚
So what do we look at instead? Well, we look at our phones, we look at our computers, we look at screens of all kinds.
é‚£æˆ‘ä»¬çœ‹çš„ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬åœ¨çœ‹æ‰‹æœºã€ç©ç”µè„‘ï¼Œæˆ‘ä»¬æ³¨è§†ç€å„ç§å„æ ·çš„ç”µå­å±å¹•ã€‚
And honestly, we rarely even take the trouble to look up enough to see each other,
è¯´å®åœ¨çš„ï¼Œæˆ‘ä»¬ç”šè‡³å¾ˆå°‘è´¹å¿ƒå»æŠ¬å¤´æ³¨è§†å½¼æ­¤ï¼Œ
let alone taking that next step to looking up at the actual sky.
æ›´ä¸è¦è¯´èµ°å‡ºæˆ¿é—¨ã€æŠ¬å¤´ä»°æœ›çœŸæ­£çš„å¤©ç©ºäº†ã€‚
Now, there's a tendency to think that the loss of our dark night skies is the inevitable1 outcome of progress, change, technology.
è¶Šæ¥è¶Šå¤šçš„äººè®¤ä¸ºï¼Œå¤œç©ºçš„æ¶ˆé€æ˜¯ç§‘æŠ€è¿›æ­¥ã€ç¤¾ä¼šå‘å±•çš„å¿…ç„¶ç»“æœã€‚
And you know, that's just simply not true. Later on, I'll tell you why.
ä½†è¿™å¹¶ä¸æ˜¯çœŸæ­£çš„åŸå› ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆã€‚
But first, I want to tell you about my experience of the dark night sky.
é¦–å…ˆï¼Œæˆ‘æƒ³ç»™ä½ ä»¬è®²è®²æˆ‘è‡ªå·±æœ‰å…³å¤œç©ºçš„ç»å†ã€‚
I never saw a truly dark night sky until I was 15. I was here, in Arizona.
æˆ‘ç›´åˆ°åäº”å²æ—¶ï¼Œæ‰è§è¿‡çœŸæ­£çš„å¤œç©ºã€‚å½“æ—¶ï¼Œæˆ‘å°±åœ¨äºšåˆ©æ¡‘é‚£å·ã€‚
I was on a road trip; I pulled over somewhere. I have no idea where I was, except I know what state.
é‚£æ˜¯ä¸€æ¬¡æ—…é€”ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªåœ°æ–¹é è¾¹åœäº†è½¦ã€‚å½“æ—¶é™¤äº†å·åä»¥å¤–ï¼Œæˆ‘å¯¹èº«åœ¨ä½•å¤„ä¸€æ— æ‰€çŸ¥ã€‚
And I looked up, and the sky was just filled with an impossible number of stars.
å°±é‚£ä¹ˆä¸ç»æ„åœ°æŠ¬å¤´ä¸€æœ›ï¼Œæˆ‘çœ‹åˆ°äº†å¸ƒæ»¡ç¹æ˜Ÿçš„å¤œç©ºï¼
You see, I'm from New York City, and in New York, you can see the moon, you can see a couple of stars.
æƒ³æƒ³çœ‹ï¼Œæˆ‘æ¥è‡ªçº½çº¦ï¼Œåœ¨é‚£ä¸ªåŸå¸‚ï¼Œä½ åªèƒ½çœ‹åˆ°æœˆäº®å’Œå‡ é¢—â€œé›¶æ˜Ÿâ€ã€‚
More often than not, they turn out to be airplanes when they land.
è€Œä¸”é€šå¸¸å½“â€œé›¶æ˜Ÿâ€é™è½æ—¶ï¼Œä½ æ‰å‘ç°ï¼Œå®ƒä»¬å…¶å®æ˜¯é£æœºã€‚
But there's really not much else.
é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå…¶å®ƒä¸œè¥¿äº†ã€‚
As a result, most of my colleagues who are astronomers2 spent at least part of their youth looking up at the sky in their backyard.
æˆ‘çš„å¤§å¤šæ•°å¤©æ–‡å­¦å®¶åŒäº‹ä»¬ï¼Œè‡³å°‘éƒ½æœ‰è¿‡ä¸€æ®µå¤œæ™šåœ¨è‡ªå®¶åé™¢æ•°æ˜Ÿæ˜Ÿçš„ç«¥å¹´æ—¶å…‰ã€‚
I never really had that experience, and, as a result, I'm really disappointing on camping trips.
è€Œæˆ‘å´ä»æœªæœ‰è¿‡é‚£ç§ç»å†ï¼Œæ‰€ä»¥åœ¨éœ²è¥æ—…é€”ä¸­ï¼Œæˆ‘çš„è¡¨ç°ä»¤äººå¤§å¤±æ‰€æœ›ã€‚
I don't really know many constellations3.
å…³äºæ˜Ÿåº§æ–¹é¢çš„çŸ¥è¯†æå…¶æœ‰é™ã€‚
The ones I do know, you probably know them, too.
è€Œæˆ‘æ‰€çŸ¥é“çš„ä¸ºæ•°ä¸å¤šçš„å‡ ä¸ªæ˜Ÿåº§ï¼Œç›¸ä¿¡åœ¨åº§çš„å„ä½ä¹Ÿéƒ½è€³ç†Ÿèƒ½è¯¦ã€‚
But I'll never forget that experience of the first time I saw the dark night sky.
ä½†æˆ‘æ°¸è¿œä¸ä¼šå¿˜è®°å¹³ç”Ÿç¬¬ä¸€æ¬¡çœ‹åˆ°å¤œç©ºçš„ç»å†ã€‚
And I was just flabbergasted at how many stars there were. And I felt tiny.
é‚£æ¼«å¤©çš„ç¹æ˜Ÿæ·±æ·±éœ‡æ’¼äº†æˆ‘ï¼Œè®©æˆ‘æ„Ÿåˆ°è‡ªå·±æ— æ¯”æ¸ºå°ã€‚
Then I also felt like, "Where's this been hiding this whole time? Who's been hiding this sky from me?"
æ¥ä¸‹æ¥ï¼Œæˆ‘å°±æœ‰äº†è¿™æ ·çš„ç–‘æƒ‘ï¼šè¿™äº›å¥‡æ™¯ä¸€ç›´ä»¥æ¥è¢«è—åœ¨äº†å“ªé‡Œï¼Ÿæ˜¯è°è—åŒ¿äº†è¿™æ ·çš„å¤©ç©ºï¼Ÿ
Of course, the answer is obvious if you think about it or if you look at the picture on the left,
ä¸è¿‡ä»”ç»†ä¸€æƒ³ï¼Œç­”æ¡ˆå…¶å®æ˜¾è€Œæ˜“è§ï¼Œæˆ–è€…çœ‹ä¸€ä¸‹å·¦è¾¹çš„ç…§ç‰‡å°±æ˜ç™½äº†ï¼Œ
where you're seeing the same neighborhood taken during a blackout versus4 on an ordinary night.
è¿™æ˜¯åŒä¸€è¡—åŒºåœç”µæ—¶æ‹æ‘„çš„å¤œç©ºï¼Œå³è¾¹æ˜¯æ™®é€šå¤œæ™šæ‹æ‘„çš„å¤œç©ºç…§ç‰‡ã€‚
You can't see the stars if you drown them out with light.
å½“æ˜Ÿæ˜Ÿè¢«ç¯å…‰æ·¹æ²¡æ—¶ï¼Œä½ è‡ªç„¶å°±çœ‹ä¸åˆ°å®ƒä»¬ã€‚
Take a look at our planet. This is our planet from space.
ç°åœ¨è¯·å®¡è§†ä¸€ä¸‹æˆ‘ä»¬çš„åœ°çƒï¼Œè¿™æ˜¯ä»å¤ªç©ºæ‹æ‘„çš„åœ°çƒã€‚
Unlike stars, which are hot and glow invisible light so we can see them,
æ’æ˜Ÿå‘å‡ºçƒ­é‡å’Œä¸å¯è§å…‰ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½çœ‹åˆ°å®ƒä»¬ï¼Œ
our planet is, astronomically5 speaking, pretty cold. So it doesn't really glow.
è€Œåœ°çƒä¸æ’æ˜Ÿä¸åŒï¼Œä»å¤©æ–‡å­¦ä¸Šè®²ï¼Œåœ°çƒå¾ˆå†·ï¼Œæ‰€ä»¥å…¶è‡ªèº«å¹¶ä¸å‘å…‰ã€‚
When you see the planet looking like a blue-green marble the way it does in this picture,
å½“ä½ çœ‹åˆ°å›¾ä¸­å±•ç°çš„è¿™é¢—å¦‚è“ç»¿è‰²å¤§ç†çŸ³èˆ¬çš„åœ°çƒæ—¶ï¼Œ
you're seeing it because the sunlight is reflecting off of it,
ä½ èƒ½çœ‹è§å®ƒæ˜¯å› ä¸ºå®ƒåå°„äº†å¤ªé˜³å…‰çš„ç¼˜æ•…ã€‚
and that's why you can see the oceans, the clouds, the land.
è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä½ èƒ½çœ‹åˆ°æµ·æ´‹ã€äº‘æœµå’Œé™†åœ°ã€‚
So if the sun wasn't shining on it, we wouldn't be able to see the earth, right? Or would we?
ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ²¡æœ‰å¤ªé˜³çš„ç…§å°„ï¼Œæˆ‘ä»¬å°±çœ‹ä¸åˆ°åœ°çƒäº†ï¼Œå¯¹å—ï¼Ÿæˆ–è€…ï¼Œæˆ‘ä»¬ä¾ç„¶èƒ½çœ‹åˆ°å®ƒï¼Ÿ
This is our earth at night, and it is one of the most striking examples of how we have affected6 our planet on a global scale.
è¿™æ˜¯å¤œæ™šçš„åœ°çƒï¼Œè¿™æ˜¯äººç±»åœ¨å…¨çƒèŒƒå›´å†…å¯¹åœ°çƒé€ æˆæ˜¾è‘—å½±å“çš„ä¾‹å­ä¹‹ä¸€ã€‚
You can see light spidering out across the globe everywhere.
ä½ å¯ä»¥çœ‹åˆ°å…‰äº®æ•£æ’­åˆ°äº†å…¨çƒçš„å„ä¸ªè§’è½ï¼Œ
Now, of course, there are broad expanses of ocean that are still dark,
å½“ç„¶ï¼Œç°åœ¨å¹¿é˜”çš„æµ·æ´‹ä¾æ—§å¤„äºé»‘æš—ä¸­ï¼Œ
and in many underdeveloped areas there's still darkness.
å¾ˆå¤šä¸å‘è¾¾çš„åœ°åŒºçœ‹èµ·æ¥ä¹Ÿæ˜¯æ¼†é»‘ä¸€ç‰‡ã€‚
But you'll notice that this is a pretty global effect.
ä½†ä½ ä¼šå‘ç°è¿™å…¶å®å·²ç»æˆä¸ºäº†å…¨çƒç°è±¡ã€‚
We tend to think, when we think of places being lit up, of very extreme examples -- Times Square, the Vegas Strip.
å½“æåˆ°ç¯ç«é€šæ˜çš„åœ°æ–¹æ—¶ï¼Œæˆ‘ä»¬æ€»ä¼šæƒ³èµ·é‚£äº›æœ€æç«¯çš„ä¾‹å­ï¼Œæ¯”å¦‚æ—¶ä»£å¹¿åœºã€æ‹‰æ–¯ç»´åŠ æ–¯å¤§é“ã€‚
But really what that picture shows you is that it's not just these extreme examples, it's anywhere that uses outdoor lighting7.
ä½†é‚£å¼ æ•´ä¸ªåœ°çƒçš„ç…§æ˜æƒ…å†µå›¾ç‰‡æ˜¾ç¤ºçš„ä¸ä»…ä»…æ˜¯è¿™å‡ ä¸ªæç«¯ä¸ªä¾‹ï¼Œè€Œæ˜¯ä»»ä½•ä½¿ç”¨æˆ·å¤–ç…§æ˜çš„åœ°æ–¹ã€‚
This tends to be a really dramatic effect on the ground.
è¿™å¾€å¾€ç»™åœ°çƒè¡¨é¢å¸¦æ¥çœŸæ­£å·¨å¤§çš„å½±å“ã€‚
To understand why, all you really have to do is think about the shape of a lightbulb.
æƒ³çŸ¥é“ä¸ºä»€ä¹ˆï¼Œä½ åªéœ€æƒ³æƒ³ç¯æ³¡çš„å½¢çŠ¶ã€‚
The lightbulb, for all practical purposes, is more or less round.
ä¸ºäº†å®ç”¨çš„ç›®çš„ï¼Œç¯æ³¡åŸºæœ¬ä¸Šéƒ½æ˜¯åœ†çš„ã€‚
This is great for its original intended purpose of lighting up the indoors.
è¿™æ­£ç¬¦åˆå®ƒæœ€åˆçš„ç›®çš„ï¼Œå®¤å†…ç…§æ˜ã€‚
You turn it on, light goes everywhere. An individual light bulb can light up your whole room, more or less.
ä½ æ‰“å¼€ç¯ï¼Œç¯å…‰ç…§å°„åˆ°æˆ¿é—´çš„æ¯ä¸ªè§’è½ã€‚ä¸€ä¸ªç¯æ³¡å°±èƒ½ç…§äº®æ•´ä¸ªæˆ¿é—´ï¼Œåªæ˜¯æ˜æš—ç¨‹åº¦çš„å·®å¼‚ã€‚
Now, that's great if you're lighting the indoors, but in its application in outdoor lighting,
å¦‚æœä½ æƒ³ç…§äº®å®¤å†…ï¼Œè¿™ç¡®å®éå¸¸æœ‰æ•ˆï¼›ä½†å½“æˆ‘ä»¬ç”¨äºå®¤å¤–ç…§æ˜æ—¶ï¼Œ
that traditional shape of the light bulb, the sort of globe that spreads light everywhere, is actually very inefficient8.
ä¼ ç»Ÿçš„ç¯æ³¡å½¢çŠ¶ï¼Œå³é‚£ç§å‘å››å‘¨ä¼ æ’­å…‰çº¿çš„çƒå½¢ç¯æ³¡ï¼Œå…¶å®æ˜¯ååˆ†ä½æ•ˆçš„ã€‚
When you're outdoors, mostly what you care about is lighting the ground beneath you and your immediate9 surroundings.
å½“ä½ èº«å¤„å®¤å¤–æ—¶ï¼Œä½ æœ€å…³å¿ƒçš„æ˜¯ç…§äº®ä½ è„šä¸‹çš„åœ°é¢å’Œå‘¨å›´çš„ç¯å¢ƒã€‚
All of that light that gets scattered10 outwards11 and upwards12 doesn't actually help you light the area around you.
æ‰€æœ‰é‚£äº›åˆ†æ•£å‘å¤–æˆ–å‘ä¸Šçš„å…‰ï¼Œéƒ½å¹¶ä¸èƒ½å¸®ä½ æœ‰æ•ˆåœ°ç…§äº®ä½ å‘¨å›´çš„åŒºåŸŸã€‚
What it does is scatters13 up into the sky and becomes what we call "light pollution."
å®ƒåªæ˜¯å°†å…‰çº¿æ•£å°„åˆ°å¤©ç©ºï¼Œé€ æˆæˆ‘ä»¬æ‰€è¯´çš„â€œå…‰æ±¡æŸ“â€ã€‚
Even if you don't care anything about stargazing, this should worry you,
å³ä½¿ä½ ä¸åœ¨æ„æ˜Ÿè±¡è§‚æµ‹ï¼Œä½ ä¹Ÿåº”è¯¥å…³å¿ƒå…‰æ±¡æŸ“ï¼Œ
because it means that 60-70% of the energy we use to light the outdoors is wasted by blotting14 out the stars.
å› ä¸ºï¼Œå®ƒæ„å‘³ç€æˆ‘ä»¬ç”¨äºå®¤å¤–ç…§æ˜çš„60-70%çš„èƒ½é‡è¢«æµªè´¹åœ¨å±è”½å¤œæ™šçš„æ˜Ÿå…‰äº†ã€‚
Now, like I said, I'm a big fan of technology.
 
æ­£å¦‚æˆ‘æ‰€è¯´çš„ï¼Œæˆ‘æ˜¯ä¸ªå¤§ç§‘æŠ€è¿·ã€‚
Obviously, I use technology every day; I'm a scientist.
ä½œä¸ºä¸€ä¸ªç§‘å­¦å®¶ï¼Œæ˜¾ç„¶æ¯å¤©æˆ‘éƒ½ä½¿ç”¨é«˜ç§‘æŠ€ã€‚
And there's this tendency to say that it's progress that -- you know, I'm not suggesting we're going to all go live by candlelight.
å¤§å®¶å€¾å‘äºè®¤ä¸ºè¿™æ˜¯è¿›æ­¥--æˆ‘å¹¶éå»ºè®®å¤§å®¶åœ¨çƒ›å…‰ä¸‹ç”Ÿæ´»ã€‚
Indeed, technology is allowing us to access the sky in ways that are impossible otherwise.
ç¡®å®ï¼Œç§‘æŠ€ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ¥è¿‘å¤©ç©ºã€‚
One of the greatest examples of this is, of course, the Hubble Space Telescope.
ç”¨ä¸€ç§åªæœ‰ç§‘æŠ€èƒ½å¤Ÿåšåˆ°çš„æ–¹å¼ï¼Œå½“ç„¶ï¼Œæœ€ä¼Ÿå¤§çš„ä¾‹å­å°±æ˜¯å“ˆå‹ƒå¤ªç©ºæœ›è¿œé•œã€‚
The Hubble went up into space, it returns pictures daily,
å“ˆå‹ƒæœ›è¿œé•œè¢«å‘å°„è¿›å…¥å¤ªç©ºï¼Œæ¯å¤©éƒ½ä¼ å›å¤§é‡ç…§ç‰‡ï¼Œ
and it allows us to see things that we are incapable15 of seeing with our naked eye,
è®©æˆ‘ä»¬çœ‹åˆ°å¤ªç©ºçš„äº‹ç‰©ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬è‚‰çœ¼æ‰€çœ‹ä¸åˆ°çš„ï¼Œ
in ways that we've never been able to do before in all of human history.
åœ¨äººç±»å†å²çš„ä»»ä½•é˜¶æ®µï¼Œæˆ‘ä»¬éƒ½ä»æ²¡è¿™ä¹ˆåšè¿‡ã€‚
Other examples of this would be planetarium16 shows.
å…¶å®ƒç±»ä¼¼çš„ä¾‹å­å½“ç„¶è¿˜æœ‰å¤©ä½“å±•ç¤ºã€‚
In the past couple of years, planetarium shows have become more high-tech17 with these great visualizations,
åœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œå€ŸåŠ©è¿™äº›è¶…æ£’çš„å¯è§†åŒ–ä¿¡æ¯ï¼Œå¤©ä½“å±•ç¤ºå˜å¾—è¶Šæ¥è¶Šé«˜ç§‘æŠ€åŒ–ï¼Œ
and even though this isn't access directly to the sky, it's at least access to our knowledge about the sky.
å³ä½¿è¿™å¹¶ä¸æ˜¯ç›´æ¥äº²èº«æ¥è§¦å¤©ç©ºï¼Œä½†è‡³å°‘è®©æˆ‘ä»¬è·å¾—äº†å…³äºå¤©ç©ºçš„çŸ¥è¯†ã€‚
And indeed, we can experience the sky in a planetarium in a way that is impossible for us to do just sitting out and looking in the dark.
çš„ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤©æ–‡é¦†ä½“éªŒé‚£ç§ååœ¨å®¤å¤–ã€æœ›å‘æ¼†é»‘çš„å¤œç©ºæ‰€ä½“éªŒä¸åˆ°çš„æ„Ÿè§‰ã€‚
All of you have heard of the Hubble Space Telescope and of planetariums18.
ä½ ä»¬å¤§æ¦‚éƒ½å¬è¯´è¿‡å“ˆå‹ƒå¤ªç©ºæœ›è¿œé•œå’Œå¤©æ–‡é¦†ã€‚
But there are also ways for technology to enable participation19 in people's experience of the sky that you may not be familiar with.
ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›æŠ€æœ¯å¯ä»¥è®©äººä»¬å‚ä¸åˆ°å…³äºå¤©ç©ºçš„ã€ä½ å¯èƒ½ä¸ç†Ÿæ‚‰çš„ä½“éªŒä¸­ã€‚
These are called "citizen science projects."
è¿™å°±æ˜¯æ‰€è°“çš„â€œå¹³æ°‘ç§‘å­¦é¡¹ç›®â€ã€‚
Citizen science is when large research projects put their data online, teach ordinary people, like you, to go and interact with that data
å¹³æ°‘ç§‘å­¦æ˜¯ä¸€ä¸ªå¤§çš„é¡¹ç›®ï¼Œä»–ä»¬æŠŠæ•°æ®æ”¾åˆ°äº’è”ç½‘ä¸Šï¼Œæ•™åƒåœ¨åº§å„ä½è¿™æ ·çš„æ™®é€šäººå»ä¸æ•°æ®è¿›è¡Œäº¤äº’ï¼Œ
and actually contribute to the research by making interesting or necessary characterizations about it.
é€šè¿‡ç»™æ•°æ®æ·»åŠ æœ‰è¶£æˆ–å¿…è¦çš„ç‰¹å¾ï¼Œè¿›è€Œå¯¹ç ”ç©¶åšå‡ºè´¡çŒ®ã€‚
One such example of this is what I'm showing here, called "Galaxy20 Zoo."
ç±»ä¼¼çš„ä¾‹å­å°±æ˜¯æˆ‘ç°åœ¨å±•ç¤ºçš„â€œé“¶æ²³åŠ¨ç‰©å›­â€é¡¹ç›®ã€‚
Galaxy Zoo is a project where people get a 20-minute -- even less than that, actually
é“¶æ²³åŠ¨ç‰©å›­é¡¹ç›®æ˜¯è¿™æ ·çš„ï¼šäººä»¬ç»è¿‡20åˆ†é’Ÿçš„æŒ‡å¯¼--å®é™…ä¸Šå°‘äº20åˆ†é’Ÿï¼Œ
tutorial on how to interact with these images of galaxies21.
å­¦ä¹ å…³äºå¦‚ä½•ä¸è¿™äº›æ˜Ÿç³»çš„å›¾åƒè¿›è¡Œäº¤äº’ã€‚
They learn to annotate22 the images, and within a couple of minutes, they're up and running,
ä»–ä»¬å­¦ä¹ ä¸ºå›¾åƒåšæ³¨é‡Šï¼Œåœ¨å‡ åˆ†é’Ÿå†…ï¼Œä»–ä»¬å°±èƒ½ç€æ‰‹å¼€å§‹å·¥ä½œï¼Œ
and they're making really useful categorizations and classifications of these galaxies.
è€Œä¸”çœŸæ­£èƒ½å¤Ÿå¯¹è¿™äº›æ˜Ÿç³»è¿›è¡Œæœ‰ç”¨çš„å½’ç±»å’Œåˆ’åˆ†ã€‚
Now, it's easy to understand why Galaxy Zoo would be an easy sell for people to be involved with:
å¾ˆå®¹æ˜“å°±èƒ½ç†è§£ä¸ºä½•â€œé“¶æ²³åŠ¨ç‰©å›­â€å¾ˆå®¹æ˜“è¢«å‚ä¸å…¶ä¸­çš„äººæ‰€æ¥å—ï¼š
it involves pretty pictures; galaxies are, generally speaking, pretty attractive.
å®ƒåŒ…å«äº†æ¼‚äº®çš„å›¾ç‰‡ï¼›é€šå¸¸æ¥è¯´ï¼Œæ˜Ÿç³»çš„ç¡®å¾ˆå¸å¼•äººã€‚
However, there are many other flavors of citizen science projects that people have delved23 into that have varying levels of abstraction,
ç„¶è€Œï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–ç±»å‹çš„å¹³æ°‘ç§‘å­¦é¡¹ç›®ï¼Œäººä»¬æ¢ç©¶è¿‡çš„è¿™äº›é¡¹ç›®æŠ½è±¡ç¨‹åº¦å„ä¸ç›¸åŒï¼Œ
that you wouldn't necessarily think people would jump at.
ä½ ä¼šè§‰å¾—äººä»¬ä¸å¤ªä¼šç«‹åˆ»å‚ä¸è¿™äº›é¡¹ç›®ã€‚
One such example of this is the citizen science project associated with the mission that I'm part of, called the Kepler Mission.
ä¸€ä¸ªç±»ä¼¼çš„ä¾‹å­å°±æ˜¯ä¸æˆ‘å‚åŠ çš„ä»»åŠ¡ç›¸å…³çš„ä¸€ä¸ªå¹³æ°‘ç§‘å­¦é¡¹ç›®ï¼Œå«åšâ€œå¼€æ™®å‹’ä»»åŠ¡â€ã€‚
Kepler is a space telescope and it looks for planets around other stars by measuring the light from those stars very precisely24.
å¼€æ™®å‹’æ˜¯ä¸€ä¸ªå¤ªç©ºæœ›è¿œé•œï¼Œå®ƒé€šè¿‡ç²¾ç¡®æµ‹é‡æ’æ˜Ÿçš„å…‰çº¿ï¼ˆå˜åŒ–ï¼‰æ¥å¯»æ‰¾æ’æ˜Ÿå‘¨å›´çš„è¡Œæ˜Ÿã€‚
And we're looking for the dimmings caused by stars blocking off some of that light.
æˆ‘ä»¬åœ¨å¯»æ‰¾æ’æ˜Ÿå› ä¸ºå…‰çº¿è¢«ï¼ˆå›´ç»•å…¶è¿è½¬çš„è¡Œæ˜Ÿï¼‰é˜»æŒ¡è€Œå‘ç”Ÿçš„å¾®æš—ç°è±¡ã€‚
We have an associated citizen science project called "Planet Hunters."
æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸æ­¤ç›¸å…³çš„â€œè¡Œæ˜ŸçŒæ‰‹â€å¹³æ°‘ç§‘å­¦é¡¹ç›®ã€‚
Planet Hunters gives you, like Galaxy Zoo, a short tutorial, and within a couple of minutes, you're up and running;
ç±»ä¼¼äºé“¶æ²³åŠ¨ç‰©å›­ï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿä¼šæä¾›ç»™ä½ ä¸€ä¸ªçŸ­æ•™ç¨‹ï¼Œå‡ åˆ†é’Ÿä¹‹åï¼Œä½ å°±å¯ä»¥å¼€å§‹å·¥ä½œï¼›
you're looking at data from the Kepler Mission and looking for planets.
ä½ éœ€è¦è§‚å¯Ÿæ¥è‡ªå¼€æ™®å‹’ä»»åŠ¡çš„æ•°æ®ï¼Œå¹¶å¯»æ‰¾è¡Œæ˜Ÿã€‚
The idea behind this is an easy sell, right?
èƒŒåçš„æƒ³æ³•å¾ˆå®¹æ˜“è¢«æ¥å—ï¼Œå¯¹å—ï¼Ÿ
But the actual process of planet-hunting involves a lot of looking at graphs,
ä½†æ¢ç´¢è¡Œæ˜Ÿçš„å®é™…è¿‡ç¨‹åŒ…å«å¯¹å¤§é‡å›¾è¡¨è¿›è¡Œè§‚å¯Ÿåˆ†æï¼Œ
like the one I'm showing you here, and annotating25 them.
å°±åƒè¿™é‡Œæˆ‘å‘ä½ ä»¬å±•ç¤ºçš„ä¸€æ ·ï¼Œéœ€è¦å»åˆ†æå’Œæ³¨é‡Šå®ƒä»¬ã€‚
I do this all day and that doesn't even sound that interesting to me.
æˆ‘æ•´å¤©éƒ½åšè¿™äº›å·¥ä½œï¼Œæ‰€ä»¥å·²ç»ä¸è§‰å¾—é‚£ä¹ˆæœ‰è¶£äº†ã€‚
However, not only are people interested in doing this,
ç„¶è€Œï¼Œäººä»¬ä¸ä»…å¯¹æ­¤å¾ˆæ„Ÿå…´è¶£ï¼Œ
but the citizen scientists that work with Planet Hunters have actually found planets in the data that would have gone undiscovered otherwise.
è€Œä¸”å‚ä¸â€œè¡Œæ˜ŸçŒæ‰‹â€é¡¹ç›®çš„å¹³æ°‘ç§‘å­¦å®¶ä»¬åœ¨æ•°æ®ä¸­çœŸçš„å‘ç°äº†è¡Œæ˜Ÿï¼Œå¤šäºäº†ä»–ä»¬ï¼Œæ‰ä¸è‡³äºé”™å¤±å‘ç°è¿™äº›è¡Œæ˜Ÿçš„æœºä¼šã€‚
This is an author list from the paper that they published of the planet they discovered.
è¿™æ˜¯ä»–ä»¬å‘è¡¨çš„å…³äºæ‰€å‘ç°è¡Œæ˜Ÿè®ºæ–‡ä¸­çš„ä½œè€…åˆ—è¡¨ã€‚
You'll see that all the people who contributed are listed below,
ä½ ä¼šçœ‹åˆ°ï¼Œæ‰€æœ‰å¯¹æ­¤åšå‡ºè´¡çŒ®çš„äººä»¬éƒ½åœ¨ä»¥ä¸‹åå•ä¸­åˆ—å‡ºï¼Œ
and it's sort of an odd amalgam26 of people's real names and their log-in names.
åå•æœ‰ç‚¹åƒäººä»¬çœŸå®å§“åå’Œä»–ä»¬ç™»å½•åçš„å¥‡æ€ªç»„åˆã€‚
You'll notice if you look carefully, this is the first academic acknowledgment of the importance of Irish coffee in the discovery process.
å¦‚æœä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šå‘ç°è¿™æ˜¯å­¦æœ¯åœˆç¬¬ä¸€æ¬¡è®¤å¯çˆ±å°”å…°å’–å•¡åœ¨å‘ç°è¡Œæ˜Ÿè¿‡ç¨‹ä¸­çš„é‡è¦æ€§ã€‚
I don't want to give you the idea that these are some out-of-work scientists or just a bunch of nerds that are really into this.
æˆ‘ä¸æƒ³ç»™ä½ è¿™æ ·çš„é”™è§‰ï¼Œä»¥ä¸ºè¿™äº›åªæ˜¯ä¸€äº›å¤±ä¸šçš„ç§‘å­¦å®¶æˆ–ä¸€äº›ä¹¦å‘†å­æ‰ä¼šç—´è¿·çš„é¡¹ç›®ã€‚
There are 60,000 people who participate in these projects, and most of them don't have technical backgrounds.
å…¶å®ï¼Œä¸€å…±æœ‰6ä¸‡äººå‚ä¸äº†è¿™äº›é¡¹ç›®ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†äººéƒ½æ²¡æœ‰æŠ€æœ¯èƒŒæ™¯ã€‚
So clearly, what this is feeding into is people's curiosity and their willingness to be part of the scientific discovery process.
æ˜¾ç„¶ï¼Œäººä»¬å‚ä¸å…¶ä¸­æ˜¯å› ä¸ºå¥½å¥‡å¿ƒé©±ä½¿ï¼Œè¿˜æœ‰ä»–ä»¬å‚ä¸ç§‘å­¦å‘ç°è¿‡ç¨‹çš„æ„æ„¿ã€‚
People want to do this. But all of this technology and all these digitally mediated27 ways of experiencing the sky
äººä»¬æƒ³å»åšè¿™æ ·çš„äº‹æƒ…ã€‚ä½†æ˜¯æ‰€æœ‰è¿™äº›æŠ€æœ¯ï¼Œä»¥åŠæ‰€æœ‰è¿™äº›ä½“éªŒå¤©ç©ºçš„æ•°ç åª’ä»‹æ–¹å¼ï¼Œ
still have something of a feel to me like looking at an animal in a zoo.
ä»å¸¦ç»™æˆ‘ä¸€ç§åƒåœ¨åŠ¨ç‰©å›­çœ‹åŠ¨ç‰©çš„æ„Ÿè§‰ã€‚
It's a valid28 way of experiencing that thing -- indeed, the lion in the cage is still real, the Hubble images are indeed real,
è¿™æ˜¯ä½“éªŒå¤©ç©ºçš„æœ‰æ•ˆæ–¹å¼ï¼Œç¡®å®ï¼Œç¬¼é‡Œçš„ç‹®å­ä¾æ—§æ˜¯çœŸå®çš„ï¼Œå“ˆå‹ƒå›¾ç‰‡ä¹Ÿç¡®å®æ˜¯çœŸå®çš„ï¼Œ
and you can get closer to a lion in a zoo than you can in the wild. However, it's missing something.
è€Œä¸”ï¼Œä½ åœ¨åŠ¨ç‰©å›­é‡Œæ¯”åœ¨é‡å¤–æ›´æ¥è¿‘ç‹®å­ã€‚ç„¶è€Œï¼Œè¿™é‡Œç¼ºå°‘äº†ä¸€äº›ä¸œè¥¿ã€‚
It's missing that savage29 beauty of experiencing that very thing in the wild for yourself, unmediated by a screen.
ç¼ºå°‘ä½ åœ¨é‡å¤–äº²èº«ä½“éªŒåˆ°çš„é‚£ç§é‡æ€§ä¹‹ç¾ï¼Œæœªæ›¾ç»è¿‡è§å±è¿™å±‚åª’ä»‹ã€‚
The experience of looking up and knowing that the sky you're looking at surrounds every known living thing in the universe is very profound.
 
ä»°æœ›å¤©ç©ºï¼Œå¹¶è®¤è¯†åˆ°ä½ æ­£è§‚çœ‹çš„å¤©ç©ºåŒ…å›´ç€å®‡å®™ä¸­æ‰€æœ‰çš„å·²çŸ¥ç”Ÿç‰©ï¼Œè¿™ç§æ„Ÿå—æ„ä¹‰æ·±è¿œã€‚
Think about that for a moment. We are the only planet we know of that has life on it.
è¯•æƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ˜¯å”¯ä¸€å·²çŸ¥çš„å­˜åœ¨ç”Ÿå‘½çš„æ˜Ÿçƒã€‚
The sky that you see is shared by every other living thing that we know of in existence.
ä½ æ‰€çœ‹åˆ°çš„å¤©ç©ºï¼Œæ˜¯ä¸å·²çŸ¥ä¸–é—´ä¸‡ç‰©å…±äº«çš„ï¼Œ
One of the things that I really like about my work is that
æˆ‘çœŸæ­£å–œæ¬¢è‡ªå·±èŒä¸šçš„ä¸€ç‚¹æ˜¯ï¼Œ
it allows me to step back from my every day and to experience the larger context,
å®ƒè®©æˆ‘æŠ›å¼€æ—¥å¸¸çš„ç”Ÿæ´»ï¼Œå»ä½“éªŒæ›´ä¸°å¯Œçš„å†…æ¶µï¼Œ
this feeling that just as we go out and try to find planets in the universe that might be like ours,
è¿™ç§æ„Ÿè§‰å°±å¥½åƒæˆ‘ä»¬é¨æ¸¸å®‡å®™å»å¯»æ‰¾æ–°çš„è¡Œæ˜Ÿï¼Œå¯èƒ½å’Œåœ°çƒä¸€æ ·çš„æ˜Ÿçƒï¼Œ
it always reminds me of how precious what we have here is.
è¿™æ€»æ˜¯æé†’æˆ‘ç°åœ¨çš„ç”Ÿæ´»æœ‰å¤šä¹ˆçè´µã€‚
Our night sky is like a natural resource, it's as though it's a park that you can visit without ever having to travel there.
æˆ‘ä»¬çš„å¤œç©ºå°±åƒè‡ªç„¶èµ„æºï¼Œå°±åƒä¸€ä¸ªæ— é¡»ç»å†æ—…æ¸¸åŠ³é¡¿å°±å¯ä»¥å‚è§‚çš„å…¬å›­ã€‚
But like any natural resource,
ä½†æ˜¯ï¼Œå°±åƒå…¶ä»–çš„è‡ªç„¶èµ„æºä¸€æ ·ï¼Œ
if we don't protect it, if we don't preserve it and treasure it, it will slip away from us and be gone.
å¦‚æœæˆ‘ä»¬ä¸å»ä¿æŠ¤å®ƒã€ä¿å­˜å®ƒå’Œçæƒœå®ƒï¼Œå®ƒå°†ä¼šä»æˆ‘ä»¬èº«è¾¹æ¶ˆå¤±ã€‚
So if you're interested in this, and this is something you want to learn more about,
å› æ­¤ï¼Œå¦‚æœä½ ä»¬å¯¹æ­¤æ„Ÿå…´è¶£ï¼Œå¦‚æœè¿™ä¹Ÿæ˜¯ä½ æƒ³å¤šäº†è§£çš„ä¸œè¥¿ï¼Œ
I encourage you in particular to visit darksky.org
æˆ‘ç‰¹åˆ«é¼“åŠ±ä½ ä»¬å»è®¿é—®ç½‘ç«™â€œdarksky.orgâ€ï¼Œ
and to learn more about the choices you can make that can protect the dark night sky,
å»å­¦ä¹ æ›´å¤šå…³äºä½ èƒ½åšå‡ºçš„é€‰æ‹©ï¼Œæ¥ä¿æŠ¤å¤œç©ºï¼Œ
because it belongs to everyone, it belongs to all of us, and therefore, it's ours to experience as we wish.
å› ä¸ºå®ƒå±äºæ¯ä¸ªäººï¼Œå±äºæˆ‘ä»¬æ‰€æœ‰äººï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬æ ¹æ®è‡ªå·±çš„æ„¿æœ›å»è¡ŒåŠ¨ã€‚
And it's also ours to lose. Thank you.
æˆè´¥çš„è´£ä»»ï¼Œéƒ½åœ¨äºæˆ‘ä»¬è‡ªå·±ã€‚è°¢è°¢ï¼


å£è¢‹ä¹¦åº—
æ´»åŠ¨å…¥å£ï¼šäº¬ä¸œappé¦–é¡µ-äº¬ä¸œå›¾ä¹¦-å³ä¾§å£è¢‹ä¹¦åº—

============Quantumultx===============
[task_local]
#å£è¢‹ä¹¦åº—
1 8,12,18 * * * https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bookshop.js, tag=å£è¢‹ä¹¦åº—, img-url=https://raw.githubusercontent.com/Orz-3/task/master/jd.png, enabled=true

================Loon==============
[Script]
cron "1 8,12,18 * * *" script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bookshop.js,tag=å£è¢‹ä¹¦åº—

===============Surge=================
å£è¢‹ä¹¦åº— = type=cron,cronexp="1 8,12,18 * * *",wake-system=1,timeout=3600,script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bookshop.js

============å°ç«ç®­=========
å£è¢‹ä¹¦åº— = type=cron,script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_bookshop.js, cronexpr="1 8,12,18* * *", timeout=3600, enable=true
 */
const $ = new Env('å£è¢‹ä¹¦åº—');
const notify = $.isNode() ? require('./sendNotify') : '';
const jdCookieNode = $.isNode() ? require('./jdCookie.js') : '';
//Node.jsç”¨æˆ·è¯·åœ¨jdCookie.jså¤„å¡«å†™äº¬ä¸œck;
//IOSç­‰ç”¨æˆ·ç›´æ¥ç”¨NobyDaçš„jd cookie
let cookiesArr = [], cookie = '', message;
const ACT_ID = 'dz2010100034444201', shareUuid = '28a699ac78d74aa3b31f7103597f8927'
let ADD_CART = false
ADD_CART = $.isNode() ? (process.env.PURCHASE_SHOPS ? process.env.PURCHASE_SHOPS : ADD_CART) : ($.getdata("ADD_CART") ? $.getdata("ADD_CART") : ADD_CART);
// åŠ å…¥è´­ç‰©è½¦å¼€å…³ï¼Œä¸ä¸œä¸œå°çªå…±äº«

let inviteCodes = [
  '28a699ac78d74aa3b31f7103597f8927@2f14ee9c92954cf79829320dd482bf49@fdf827db272543d88dbb51a505c2e869@ce2536153a8742fb9e8754a9a7d361da@38ba4e7ba8074b78851e928af2b4f6b2',
  '28a699ac78d74aa3b31f7103597f8927@2f14ee9c92954cf79829320dd482bf49@fdf827db272543d88dbb51a505c2e869'
]

if ($.isNode()) {
  Object.keys(jdCookieNode).forEach((item) => {
    cookiesArr.push(jdCookieNode[item])
  })
  if (process.env.JD_DEBUG && process.env.JD_DEBUG === 'false') console.log = () => {
  };
} else {
  let cookiesData = $.getdata('CookiesJD') || "[]";
  cookiesData = jsonParse(cookiesData);
  cookiesArr = cookiesData.map(item => item.cookie);
  cookiesArr.reverse();
  cookiesArr.push(...[$.getdata('CookieJD2'), $.getdata('CookieJD')]);
  cookiesArr.reverse();
  cookiesArr = cookiesArr.filter(item => item !== "" && item !== null && item !== undefined);
}

!(async () => {
  if (!cookiesArr[0]) {
    $.msg($.name, 'ã€æç¤ºã€‘è¯·å…ˆè·å–äº¬ä¸œè´¦å·ä¸€cookie\nç›´æ¥ä½¿ç”¨NobyDaçš„äº¬ä¸œç­¾åˆ°è·å–', 'https://bean.m.jd.com/', {"open-url": "https://bean.m.jd.com/"});
    return;
  }
  $.shareCodesArr = []
  await requireConfig()
  for (let i = 0; i < cookiesArr.length; i++) {
    if (cookiesArr[i]) {
      cookie = cookiesArr[i];
      $.UserName = decodeURIComponent(cookie.match(/pt_pin=(.+?);/) && cookie.match(/pt_pin=(.+?);/)[1])
      $.index = i + 1;
      $.isLogin = true;
      $.nickName = '';
      message = '';
      await TotalBean();
      console.log(`\n******å¼€å§‹ã€äº¬ä¸œè´¦å·${$.index}ã€‘${$.nickName || $.UserName}*********\n`);
      if (!$.isLogin) {
        $.msg($.name, `ã€æç¤ºã€‘cookieå·²å¤±æ•ˆ`, `äº¬ä¸œè´¦å·${$.index} ${$.nickName || $.UserName}\nè¯·é‡æ–°ç™»å½•è·å–\nhttps://bean.m.jd.com/`, {"open-url": "https://bean.m.jd.com/"});
        if ($.isNode()) {
          await notify.sendNotify(`${$.name}cookieå·²å¤±æ•ˆ - ${$.UserName}`, `äº¬ä¸œè´¦å·${$.index} ${$.UserName}\nè¯·é‡æ–°ç™»å½•è·å–cookie`);
        }
        continue
      }
      await shareCodesFormat()
      await jdBeauty()
    }
  }
})()
  .catch((e) => {
    $.log('', `âŒ ${$.name}, å¤±è´¥! åŸå› : ${e}!`, '')
  })
  .finally(() => {
    $.done();
  })

async function jdBeauty() {
  $.score = 0
  await getIsvToken()
  await getIsvToken2()
  await getActCk()
  await getActInfo()
  await getToken()
  await getUserInfo()
  await getActContent(false, shareUuid)
  if ($.exit) return
  await doHelpList()
  await getAllBook()
  await getMyBook()
  await getActContent(true)
  if ($.gold > 800) {
    console.log(`é‡‘å¸å¤§äº800ï¼Œå»æŠ½å¥–`)
    while ($.gold >= 800) {
      await draw()
      await $.wait(1000)
      $.gold -= 800
    }
  }
  if($.userInfo.storeGold) await chargeGold()
  await helpFriends()
  await showMsg();
}

async function helpFriends() {
  for (let code of $.newShareCodes) {
    if (!code) continue
    console.log(`å»åŠ©åŠ›å¥½å‹${code}`)
    await getActContent(true, code)
    await $.wait(500)
  }
}

// è·å¾—IsvToken
function getIsvToken() {
  return new Promise(resolve => {
    let body = 'body=%7B%22to%22%3A%22https%3A%5C%2F%5C%2Flzdz-isv.isvjcloud.com%5C%2Fdingzhi%5C%2Fbook%5C%2Fdevelop%5C%2Factivity%3FactivityId%3Ddz2010100034444201%22%2C%22action%22%3A%22to%22%7D&build=167490&client=apple&clientVersion=9.3.2&openudid=53f4d9c70c1c81f1c8769d2fe2fef0190a3f60d2&sign=f3eb9660e798c20372734baf63ab55f2&st=1610267023622&sv=111'
    $.post(jdUrl('genToken', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            $.isvToken = data['tokenKey']
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

// è·å¾—å¯¹åº”æ¸¸æˆçš„è®¿é—®Token
function getIsvToken2() {
  return new Promise(resolve => {
    let body = 'body=%7B%22url%22%3A%22https%3A%5C%2F%5C%2Flzdz-isv.isvjcloud.com%22%2C%22id%22%3A%22%22%7D&build=167490&client=apple&clientVersion=9.3.2&openudid=53f4d9c70c1c81f1c8769d2fe2fef0190a3f60d2&sign=6050f8b81f4ba562b357e49762a8f4b0&st=1610267024346&sv=121'
    $.post(jdUrl('isvObfuscator', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            $.token2 = data['token']
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

// è·å¾—æ¸¸æˆçš„Cookie
function getActCk() {
  return new Promise(resolve => {
    $.get(taskUrl("dingzhi/book/develop/activity", `activityId=${ACT_ID}`), (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if($.isNode())
            for (let ck of resp['headers']['set-cookie']) {
              cookie = `${cookie}; ${ck.split(";")[0]};`
            }
          else{
            for (let ck of resp['headers']['Set-Cookie'].split(',')) {
              cookie = `${cookie}; ${ck.split(";")[0]};`
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

// è·å¾—æ¸¸æˆä¿¡æ¯
function getActInfo() {
  return new Promise(resolve => {
    $.post(taskPostUrl('dz/common/getSimpleActInfoVo', `activityId=${ACT_ID}`), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.result) {
              $.shopId = data.data.shopId
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

// è·å¾—æ¸¸æˆçš„Token
function getToken() {
  return new Promise(resolve => {
    let body = `userId=${$.shopId}&token=${$.token2}&fromType=APP`
    $.post(taskPostUrl('customer/getMyPing', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            $.token = data.data.secretPin
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

// è·å¾—ç”¨æˆ·ä¿¡æ¯
function getUserInfo() {
  return new Promise(resolve => {
    let body = `pin=${encodeURIComponent($.token)}`
    $.post(taskPostUrl('wxActionCommon/getUserInfo', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.data) {
              console.log(`ç”¨æˆ·ã€${data.data.nickname}ã€‘ä¿¡æ¯è·å–æˆåŠŸ`)
              $.userId = data.data.id
              $.pinImg = data.data.yunMidImageUrl
              $.nick = data.data.nickname
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

// è·å¾—æ¸¸æˆä¿¡æ¯
function getActContent(info = false, shareUuid = '') {
  return new Promise(resolve => {
    let body = `activityId=${ACT_ID}&pin=${encodeURIComponent($.token)}&pinImg=${$.pinImg}&nick=${$.nick}&cjyxPin=&cjhyPin=&shareUuid=${shareUuid}`
    $.post(taskPostUrl('dingzhi/book/develop/activityContent', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (data && safeGet(data)) {
            data = JSON.parse(data);
            if (data.data) {
              $.userInfo = data.data
              if (!$.userInfo.bookStore) {
                $.exit = true
                console.log(`äº¬ä¸œè´¦å·${$.index}å°šæœªå¼€å¯å£è¢‹ä¹¦åº—ï¼Œè¯·æ‰‹åŠ¨å¼€å¯`)
                return
              }
              $.actorUuid = $.userInfo.actorUuid
              if(!info) console.log(`æ‚¨çš„å¥½å‹åŠ©åŠ›ç ä¸º${$.actorUuid}`)
              $.gold = $.userInfo.bookStore.hasStoreGold
              if (!info) {
                const tasks = data.data.settingVo
                for (let task of tasks) {
                  if (['å…³æ³¨åº—é“º'].includes(task.title)) {
                    if (task.okNum < task.dayMaxNum) {
                      console.log(`å»åš${task.title}ä»»åŠ¡`)
                      await doTask(task.settings[0].type, task.settings[0].value)
                    }
                  } else if (['é€›ä¼šåœº', 'æµè§ˆåº—é“º', 'æµè§ˆå•†å“'].includes(task.title)) {
                    if (task.okNum < task.dayMaxNum) {
                      console.log(`å»åš${task.title}ä»»åŠ¡`)
                      for (let set of task.settings.filter(vo => vo.status === 0)) {
                        await doTask(set.type, set.value)
                        await $.wait(500)
                      }
                    }
                  } else if(task.title === 'æ¯æ—¥ç­¾åˆ°'){
                    const hour = new Date().getUTCHours() + 8
                    if (8 <= hour && hour < 10 || 12 <= hour && hour < 14 || 18 <= hour && hour < 20) {
                      console.log(`å»åš${task.title}ä»»åŠ¡`)
                      for (let set of task.settings.filter(vo => vo.status === 0)) {
                        let res = await doTask(set.type, set.value)
                        if (res.result) break
                        await $.wait(500)
                      }
                    }
                  } else if (ADD_CART && ['åŠ è´­å•†å“'].includes(task.title)) {
                    if (task.okNum < task.dayMaxNum) {
                      console.log(`å»åš${task.title}ä»»åŠ¡`)
                      await doTask(task.settings[0].type, task.settings[0].value)
                    }
                  }
                }
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
function doHelpList(taskType, value) {
  let body = `activityId=${ACT_ID}&actorUuid=${$.actorUuid}&num=0&sortStatus=1`
  return new Promise(resolve => {
    $.post(taskPostUrl('dingzhi/taskact/common/getDayShareRecord', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            console.log(`ä»Šæ—¥åŠ©åŠ›æƒ…å†µ${data.data.length}/10`)
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })

}
// åšä»»åŠ¡
function doTask(taskType, value) {
  let body = `activityId=${ACT_ID}&pin=${encodeURIComponent($.token)}&actorUuid=${$.actorUuid}&taskType=${taskType}&taskValue=${value}`
  return new Promise(resolve => {
    $.post(taskPostUrl('dingzhi/book/develop/saveTask', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.result && data.data) {
              console.log(`ä»»åŠ¡å®ŒæˆæˆåŠŸï¼Œè·å¾—${data.data.addScore}ç§¯åˆ†`)
              $.score += data.data.addScore
            } else {
              console.log(`ä»»åŠ¡å®Œæˆå¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š${data.errorMessage}`)
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })

}

// æŠ½å¥–
function draw() {
  let body = `activityId=${ACT_ID}&pin=${encodeURIComponent($.token)}&actorUuid=${$.actorUuid}`
  return new Promise(resolve => {
    $.post(taskPostUrl('dingzhi/book/develop/startDraw', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (data && safeGet(data)) {
            data = JSON.parse(data);
            if (data.result && data.data) {
              if (data.data.name) {
                console.log(`æŠ½å¥–æˆåŠŸï¼Œè·å¾—å¥–å“ï¼š${data.data.name}`)
                message += `æŠ½å¥–æˆåŠŸï¼Œè·å¾—å¥–å“ï¼š${data.data.name}\n`
              } else {
                console.log(`æŠ½å¥–æˆåŠŸï¼Œè·å¾—ç©ºæ°”`)
                message += `æŠ½å¥–æˆåŠŸï¼Œè·å¾—ç©ºæ°”`
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

// è·å¾—å›¾ä¹¦
function getAllBook() {
  let body = `activityId=${ACT_ID}&actorUuid=${$.actorUuid}&pin=${encodeURIComponent($.token)}`
  return new Promise(resolve => {
    $.post(taskPostUrl('dingzhi/book/develop/getAllBook', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.result && data.data) {

              const book = data.data.bookConfigList[0]
              let num = Math.trunc(data.data.haveScore / book.buyBookScore)
              console.log(`æ‹¥æœ‰${data.data.haveScore}ç§¯åˆ†ï¼Œå¯è´­ä¹°${num}æœ¬`)
              if (num > 0) {
                await buyBook(book.uuid, num)
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

// è´­ä¹°å›¾ä¹¦
function buyBook(bookUuid, num) {
  let body = `activityId=${ACT_ID}&actorUuid=${$.actorUuid}&pin=${encodeURIComponent($.token)}&bookUuid=${bookUuid}&buyNum=${num}`
  return new Promise(resolve => {
    $.post(taskPostUrl('dingzhi/book/develop/buyBook', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.result && data.data) {
              console.log(`è´­ä¹°ã€${data.data.BookIncome.bookName}ã€‘æˆåŠŸ`)
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

function getMyBook() {
  let body = `activityId=${ACT_ID}&actorUuid=${$.actorUuid}&pin=${encodeURIComponent($.token)}&type1=1&type2=1&type3=1&type=1`
  return new Promise(resolve => {
    $.post(taskPostUrl('dingzhi/book/develop/getMyBook', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.result && data.data) {
              for (let book of data.data.myBookList) {
                if (book.isPutOn !== 1 && book.inventory > 0) {
                  console.log(`å»ä¸Šæ¶ã€${book.bookName}ã€‘`)
                  await upBook(book.bookUuid)
                }
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

function upBook(bookUuid) {
  let body = `activityId=${ACT_ID}&actorUuid=${$.actorUuid}&pin=${encodeURIComponent($.token)}&bookUuid=${bookUuid}&isPutOn=1&position=1`
  return new Promise(resolve => {
    $.post(taskPostUrl('dingzhi/book/develop/upBook', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.result && data.data) {
              console.log(`ä¸Šæ¶æˆåŠŸ`)
            } else {
              console.log(data)
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

function chargeGold() {
  let body = `activityId=${ACT_ID}&actorUuid=${$.actorUuid}&pin=${encodeURIComponent($.token)}`
  return new Promise(resolve => {
    $.post(taskPostUrl('dingzhi/book/develop/chargeGold', body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.result && data.data) {
              console.log(`é‡‘å¸æ”¶è·æˆåŠŸï¼Œè·å¾—${data.data.chargeGold}`)
            } else {
              console.log(data.errorMessage)
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}

function showMsg() {
  return new Promise(resolve => {
    message += `æœ¬æ¬¡è¿è¡Œè·å¾—ç§¯åˆ†${$.score}`;
    $.msg($.name, '', `äº¬ä¸œè´¦å·${$.index}${$.nickName}\n${message}`);
    resolve()
  })
}

function jdUrl(functionId, body) {
  return {
    url: `https://api.m.jd.com/client.action?functionId=${functionId}`,
    body: body,
    headers: {
      'Host': 'api.m.jd.com',
      'accept': '*/*',
      'user-agent': 'JD4iPhone/167490 (iPhone; iOS 14.2; Scale/3.00)',
      'accept-language': 'zh-Hans-JP;q=1, en-JP;q=0.9, zh-Hant-TW;q=0.8, ja-JP;q=0.7, en-US;q=0.6',
      'content-type': 'application/x-www-form-urlencoded',
      'Cookie': cookie
    }
  }
}

function taskUrl(function_id, body) {
  return {
    url: `https://lzdz-isv.isvjcloud.com/${function_id}?${body}`,
    headers: {
      'Host': 'lzdz-isv.isvjcloud.com',
      'Accept': 'application/x.jd-school-island.v1+json',
      'Source': '02',
      'Accept-Language': 'zh-cn',
      'Content-Type': 'application/json;charset=utf-8',
      'Origin': 'https://lzdz-isv.isvjcloud.com',
      'User-Agent': 'JD4iPhone/167490 (iPhone; iOS 14.2; Scale/3.00)',
      'Referer': `https://lzdz-isv.isvjcloud.com/dingzhi/book/develop/activity?activityId=${ACT_ID}`,
      'Cookie': `${cookie} IsvToken=${$.isvToken};`
    }
  }
}

function taskPostUrl(function_id, body) {
  return {
    url: `https://lzdz-isv.isvjcloud.com/${function_id}`,
    body: body,
    headers: {
      'Host': 'lzdz-isv.isvjcloud.com',
      'Accept': 'application/json',
      'Accept-Language': 'zh-cn',
      'Content-Type': 'application/x-www-form-urlencoded',
      'Origin': 'https://lzdz-isv.isvjcloud.com',
      'User-Agent': 'JD4iPhone/167490 (iPhone; iOS 14.2; Scale/3.00)',
      'Referer': `https://lzdz-isv.isvjcloud.com/dingzhi/book/develop/activity?activityId=${ACT_ID}`,
      'Cookie': `${cookie} isvToken=${$.isvToken};`
    }
  }
}

function TotalBean() {
  return new Promise(async resolve => {
    const options = {
      "url": `https://wq.jd.com/user/info/QueryJDUserInfo?sceneval=2`,
      "headers": {
        "Accept": "application/json,text/plain, */*",
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "zh-cn",
        "Connection": "keep-alive",
        "Cookie": cookie,
        "Referer": "https://wqs.jd.com/my/jingdou/my.shtml?sceneval=2",
        "User-Agent": $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0")
      }
    }
    $.post(options, (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (data) {
            data = JSON.parse(data);
            if (data['retcode'] === 13) {
              $.isLogin = false; //cookieè¿‡æœŸ
              return
            }
            $.nickName = data['base'].nickname;
          } else {
            console.log(`äº¬ä¸œæœåŠ¡å™¨è¿”å›ç©ºæ•°æ®`)
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve();
      }
    })
  })
}

//æ ¼å¼åŒ–åŠ©åŠ›ç 
function shareCodesFormat() {
  return new Promise(async resolve => {
    // console.log(`ç¬¬${$.index}ä¸ªäº¬ä¸œè´¦å·çš„åŠ©åŠ›ç :::${$.shareCodesArr[$.index - 1]}`)
    $.newShareCodes = [];
    if ($.shareCodesArr[$.index - 1]) {
      $.newShareCodes = $.shareCodesArr[$.index - 1].split('@');
    } else {
      console.log(`ç”±äºæ‚¨ç¬¬${$.index}ä¸ªäº¬ä¸œè´¦å·æœªæä¾›shareCode,å°†é‡‡çº³æœ¬è„šæœ¬è‡ªå¸¦çš„åŠ©åŠ›ç \n`)
      const tempIndex = $.index > inviteCodes.length ? (inviteCodes.length - 1) : ($.index - 1);
      $.newShareCodes = inviteCodes[tempIndex].split('@');
    }
    const readShareCodeRes = null //await readShareCode();
    if (readShareCodeRes && readShareCodeRes.code === 200) {
      $.newShareCodes = [...new Set([...$.newShareCodes, ...(readShareCodeRes.data || [])])];
    }
    console.log(`ç¬¬${$.index}ä¸ªäº¬ä¸œè´¦å·å°†è¦åŠ©åŠ›çš„å¥½å‹${JSON.stringify($.newShareCodes)}`)
    resolve();
  })
}
function requireConfig() {
  return new Promise(resolve => {
    console.log(`å¼€å§‹è·å–${$.name}é…ç½®æ–‡ä»¶\n`);
    //Node.jsç”¨æˆ·è¯·åœ¨jdCookie.jså¤„å¡«å†™äº¬ä¸œck;
    let shareCodes = []
    console.log(`å…±${cookiesArr.length}ä¸ªäº¬ä¸œè´¦å·\n`);
    $.shareCodesArr = [];
    if ($.isNode()) {
      //è‡ªå®šä¹‰åŠ©åŠ›ç 
      if (process.env.BOOKSHOP_SHARECODES) {
        if (process.env.BOOKSHOP_SHARECODES.indexOf('\n') > -1) {
          shareCodes = process.env.BOOKSHOP_SHARECODES.split('\n');
        } else {
          shareCodes = process.env.BOOKSHOP_SHARECODES.split('&');
        }
      }
      Object.keys(shareCodes).forEach((item) => {
        if (shareCodes[item]) {
          $.shareCodesArr.push(shareCodes[item])
        }
      })
    }
    console.log(`æ‚¨æä¾›äº†${$.shareCodesArr.length}ä¸ªè´¦å·çš„${$.name}åŠ©åŠ›ç \n`);
    resolve()
  })
}

function safeGet(data) {
  try {
    if (typeof JSON.parse(data) == "object") {
      return true;
    }
  } catch (e) {
    console.log(e);
    console.log(`äº¬ä¸œæœåŠ¡å™¨è®¿é—®æ•°æ®ä¸ºç©ºï¼Œè¯·æ£€æŸ¥è‡ªèº«è®¾å¤‡ç½‘ç»œæƒ…å†µ`);
    return false;
  }
}

function jsonParse(str) {
  if (typeof str == "string") {
    try {
      return JSON.parse(str);
    } catch (e) {
      console.log(e);
      $.msg($.name, '', 'ä¸è¦åœ¨BoxJSæ‰‹åŠ¨å¤åˆ¶ç²˜è´´ä¿®æ”¹cookie')
      return [];
    }
  }
}
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`ğŸ””${this.name}, å¼€å§‹!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============ğŸ“£ç³»ç»Ÿé€šçŸ¥ğŸ“£=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`â—ï¸${this.name}, é”™è¯¯!`,t.stack):this.log("",`â—ï¸${this.name}, é”™è¯¯!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`ğŸ””${this.name}, ç»“æŸ! ğŸ•› ${s} ç§’`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
