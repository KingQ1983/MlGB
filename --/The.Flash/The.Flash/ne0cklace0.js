/*
 * @Author: LXK9301 https://github.com/LXK9301
 * @Date: 2020-11-20 11:42:03 
 * @Last Modified by: LXK9301
 * @Last Modified time: 2020-12-12 12:27:14
 */
/*

é€‰æ‹©å­¦æ ¡é‡è¦å—ï¼Ÿ
æ–‡ç« æ¥æºï¼šæœªçŸ¥ æ–‡ç« ä½œè€…ï¼šenread å‘å¸ƒæ—¶é—´ï¼š2020-03-30 06:17 å­—ä½“ï¼š [å¤§ ä¸­ å°]ã€€ è¿›å…¥è®ºå›
(å•è¯ç¿»è¯‘:åŒå‡»æˆ–æ‹–é€‰)
Weâ€™re all told to work hard in school, so that we can get into the best colleges or universities, and be successful.
æˆ‘ä»¬éƒ½è¢«å©å’è¦åœ¨å­¦æ ¡åŠªåŠ›å­¦ä¹ ï¼Œä»¥è€ƒä¸Šæœ€å¥½çš„å­¦æ ¡æˆ–å¤§å­¦ï¼Œæˆä¸ºæˆåŠŸäººå£«ã€‚
 
But, does the school you choose actually matter?
ä½†æ˜¯ï¼Œä½ é€‰æ‹©çš„å­¦æ ¡çœŸçš„é‡è¦å—ï¼Ÿ
 
Take a look at these SAT scores for an average school which are out of 800, by the way.
çœ‹çœ‹æ™®é€šå­¦æ ¡å­¦ç”Ÿæ‰€å¾—çš„SATå¹³å‡åˆ†ï¼Œæ€»åˆ†æ˜¯800.
 
Those that have the highest SAT scores end up representing over 50% of the people who get degrees at these schools, while the lowest SAT scores only represent around 18% of the people who actually graduate. Not so surprising.
é‚£äº›è·å¾—SATæœ€é«˜åˆ†çš„å­¦ç”Ÿæœ€ç»ˆåœ¨æ‹¿åˆ°å­¦ä½çš„äººä¸­å ä¸€åŠä»¥ä¸Šï¼Œè€Œé‚£äº›è·å¾—SATæœ€ä½åˆ†çš„å­¦ç”Ÿä»…å çœŸæ­£èƒ½æ¯•ä¸šè€…çš„ç™¾åˆ†ä¹‹åå…«ã€‚è¿™æ¯«ä¸è®©äººæ„å¤–ã€‚
 
But now letâ€™s look at a top school, like Harvard.
ä½†æ˜¯è®©æˆ‘ä»¬çœ‹çœ‹é¡¶å°–å­¦æ ¡ï¼Œæ¯”å¦‚å“ˆä½›ã€‚
 
Here, the students with the lowest SAT scores, are still smarter than the best students at an average school.
åœ¨è¿™é‡Œï¼Œæ‹¿æœ€ä½SATåˆ†çš„å­¦ç”Ÿä¾æ—§æ¯”æ™®é€šå­¦æ ¡çš„å°–å­ç”Ÿèªæ˜ã€‚
 
And yet, when we look at their rate of completion, it looks awfully1 similar.
è€Œä¸”ï¼Œå½“æˆ‘ä»¬çœ‹åˆ°æ¯•ä¸šç‡çš„æ—¶å€™ï¼Œä¼šå‘ç°æœ‰æƒŠäººçš„ç›¸ä¼¼ä¹‹å¤„ã€‚
 
The top students represent just over 50% of people who graduate, while the lower SAT scores represent around 15% of people who actually graduate.
å°–å­ç”Ÿçš„æ¯•ä¸šç‡å ä¸€åŠä»¥ä¸Šï¼Œè€ŒSATä½åˆ†è€…ä»…å ç™¾åˆ†ä¹‹åäº”å·¦å³ã€‚
 
Wait, whatâ€™s going on here? This phenomenon is known as the Big Fish Little Pond Effect.
ç­‰ç­‰ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿè¿™ä¸ªç°è±¡è¢«ç§°ä¸ºå¤§é±¼å°æ± å¡˜æ•ˆåº”ã€‚
 
Simply put, we compare ourselves not globally, but to our neighbours or people who are in the same boat as we are.
ç®€å•è€Œè¨€ï¼Œæˆ‘ä»¬ä¸ä¼šæŠŠè‡ªå·±è·Ÿå…¨ä¸–ç•Œçš„äººå¯¹æ¯”ï¼Œä½†æ˜¯ä¼šè·Ÿé‚»é‡Œæˆ–è€…ç›¸åŒå¤„å¢ƒçš„äººç›¸æ¯”ã€‚
 
As a result, students at top schools compare themselves to their brilliant peers, and if youâ€™re in the bottom half of your class, youâ€™re likely to have feelings of inadequacy2.
ç»“æœæ˜¯ï¼Œé¡¶å°–å­¦æ ¡çš„å­¦ç”Ÿä¼šå’Œä»–ä»¬å‡ºè‰²çš„åŒå­¦ç›¸æ¯”ï¼Œå¦‚æœä½ åœ¨ç­ä¸Šå¤„äºä¸­ä¸‹æ¸¸ï¼Œä½ å¾ˆæœ‰å¯èƒ½ä¼šè§‰å¾—è‡ªå·±æœ‰æ‰€ä¸è¶³ã€‚
 
Even though compared to the rest of the world you are at the top.
å°½ç®¡å’Œä¸–ç•Œä¸Šå…¶ä»–æ‰€æœ‰äººç›¸æ¯”ä½ ä»å¤„äºé¡¶å°–ä½ç½®ã€‚
 
Who do you think has a higher incidence of suicide?
ä½ è®¤ä¸ºè°ä¼šæœ‰æ›´é«˜çš„è‡ªæ€ç‡ï¼Ÿ
 
People who live in developed countries that declare themselves as very happy, like Switzerland, Denmark and Canada or those which describe themselves as unhappy, like Italy, Greece, and Spain?
æ˜¯åƒç‘å£«ã€ä¸¹éº¦å’ŒåŠ æ‹¿å¤§ä¸€æ ·å£°ç§°è‡ªå·±å¾ˆå¹¸ç¦çš„å‘è¾¾å›½å®¶ï¼Œè¿˜æ˜¯åƒæ„å¤§åˆ©ã€å¸Œè…Šå’Œè¥¿ç­ç‰™ä¸€æ ·è®¤ä¸ºè‡ªå·±ä¸å¹¸ç¦çš„å›½å®¶å‘¢ï¼Ÿ
 
The happy countries. If youâ€™re depressed3 but everyone around you is also unhappy, you may think of yourself as normal, as opposed to being stuck around people who are happier than you.
æ˜¯é‚£äº›å¹¸ç¦çš„å›½å®¶ã€‚å¦‚æœä½ æƒ…ç»ªä½è½ï¼Œä½†æ˜¯å‘¨å›´çš„äººä¹Ÿä¸å¼€å¿ƒï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºè‡ªå·±å¾ˆæ­£å¸¸ï¼Œè€Œå¦‚æœä½ è¢«æ¯”ä½ å¼€å¿ƒçš„äººå›´ç»•ç€ï¼Œæƒ…å†µä¼šå®Œå…¨ç›¸åã€‚
 
Similarly, if youâ€™re very intelligent at an elite4 school, you may end up being a little fish in a very big pond.
ç±»ä¼¼çš„ï¼Œå¦‚æœä½ åœ¨ä¸€æ‰€åæ ¡ä¸­éå¸¸å‡ºè‰²ï¼Œä½ ä¹Ÿè®¸ä¼šæˆä¸ºä¸€æ¡å¤§æ± å¡˜é‡Œçš„å°é±¼ã€‚
 
And feeling as though youâ€™re at the bottom impacts your confidence and ultimately your motivation.
è‡ªå·±åœ¨å«åº•çš„æ„Ÿè§‰ä¼šå½±å“ä½ çš„ä¿¡å¿ƒï¼Œæœ€ç»ˆé˜»ç¢ä½ çš„ç§¯ææ€§ã€‚
 
Need more statistics? 50% of US students in STEM programs drop out in the first or second year of school.
éœ€è¦æ›´å¤šæ•°æ®å—ï¼ŸSTEM é¡¹ç›®ä¸­ä¸€åŠçš„ç¾å›½å­¦ç”Ÿåœ¨ç¬¬ä¸€æˆ–è€…ç¬¬äºŒå­¦å¹´å°±è¾å­¦äº†ã€‚
 
But for every 10 point decrease in the schoolâ€™s average SAT score, degree completion rises by 2%!
ä½†æ˜¯å­¦æ ¡çš„äººå‡SATåˆ†æ•°æ¯é™ä½10åˆ†ï¼Œæ¯•ä¸šç‡å°±ä¸Šå‡ç™¾åˆ†ä¹‹äºŒã€‚
 
Meaning, youâ€™re much more likely to even get your degree if you donâ€™t go to your top pick.
æ„å‘³ç€ï¼Œå¦‚æœä½ ä¸å»è‡ªå·±çš„é¦–é€‰å­¦æ ¡ï¼Œåˆ™æ›´æœ‰å¯èƒ½æ‹¿åˆ°ä½ çš„å­¦ä½è¯ã€‚
 
But who ends up being more successful in the â€˜real worldâ€™?
ä½†æ˜¯ç°å®ä¸–ç•Œä¸­æœ€ç»ˆè°æ›´æˆåŠŸå‘¢ï¼Ÿ
 
A study looking at publications produced by economists5 in their first six years after graduation showed that top students in the 99th percentile ie smarter than almost every other person at the school from the top 5 schools in America were producing an impressive amount of publications.
ä¸€é¡¹å…³äºç»æµå­¦æ¯•ä¸šç”Ÿåœ¨æ¯•ä¸š6å¹´å†…å‘è¡¨åˆŠç‰©çš„è°ƒæŸ¥æ˜¾ç¤ºæ™ºå•†æ¯”å­¦æ ¡å…¶ä»–99%çš„å­¦ç”Ÿé«˜çš„é¡¶å°–å­¦ç”Ÿâ€”â€”ç¾å›½å¤§å­¦å‰äº”çš„æ¯•ä¸šç”Ÿå‘è¡¨çš„åˆŠç‰©æ•°é‡æƒŠäººã€‚
 
But those in the 75th percentile, still the top quarter of best students, are publishing next to nothing.
ä½†æ˜¯æˆç»©å‰25çš„è¿™éƒ¨åˆ†ï¼Œè™½ç„¶ä½œä¸ºå››åˆ†ä¹‹ä¸€çš„ä¼˜ç§€å­¦ç”Ÿï¼Œä½†æ˜¯å‡ ä¹æ²¡æœ‰ä½œå“åˆŠç™»ã€‚
 
Essentially6 failures in their field.
å¯ä»¥è¯´åœ¨è‡ªå·±çš„é¢†åŸŸå†…æ˜¯å®Œå…¨çš„å¤±è´¥äº†ã€‚
 
But if we now look at the best students from the 30 worst schools, we see that theyâ€™re publishing more than those in the top quarter of the best schools in the country.
ä½†æ˜¯å¦‚æœæˆ‘ä»¬çœ‹çœ‹æœ€å·®30æ‰€å­¦æ ¡çš„å°–å­ç”Ÿï¼Œä¼šå‘ç°ä»–ä»¬å‘è¡¨çš„åˆŠç‰©æ¯”ä¼˜ç­‰å­¦æ ¡å‰25çš„å¥½å­¦ç”Ÿè¦å¤šã€‚
 
Clearly, your surroundings and peers matter.
å¾ˆæ˜æ˜¾ï¼Œä½ å‘¨å›´çš„ç¯å¢ƒå’Œä¼™ä¼´å¾ˆé‡è¦ã€‚
 
Now, of course, this doesnâ€™t cover every aspect of going to a top ranked school including the fact that having a degree from one of them can be a badge of honour, and may help you find a job more easily.
ç°åœ¨ï¼Œå½“ç„¶äº†ï¼Œè¿™å¹¶ä¸æ¶µç›–é€‰æ‹©é¡¶å°–å­¦æ ¡çš„æ‰€æœ‰æ–¹é¢ï¼ŒåŒ…æ‹¬è·å¾—è¿™äº›å­¦æ ¡çš„å­¦ä½æ˜¯ä¸€é¡¹è£èª‰çš„è±¡å¾ï¼Œä¹Ÿè®¸è¿˜èƒ½å¸®ä½ æ›´å®¹æ˜“æ‰¾åˆ°ä¸€ä»½å·¥ä½œã€‚
 
But, thatâ€™s if you ever even graduate.
ä½†æ˜¯ï¼Œå‰ææ˜¯ä½ èƒ½å¤Ÿæ¯•ä¸šã€‚
 
So when youâ€™re applying for school, or even at your new college, keep in mind that whether you go to the best or worst school, the formula for success is mixed.
å› æ­¤å½“ä½ ç”³è¯·å¤§å­¦çš„æ—¶å€™ï¼Œæˆ–è€…æ˜¯å¼€å§‹å¿µæ–°å­¦é™¢çš„æ—¶å€™ï¼Œè®°ä½ä¸ç®¡ä½ ä¸Šçš„æ˜¯æœ€å¥½è¿˜æ˜¯æœ€å·®çš„å­¦æ ¡ï¼ŒæˆåŠŸçš„é…æ–¹éƒ½æ˜¯æ··æ‚çš„ã€‚
 
Remember the importance of confidence in your abilities, and how being a Big Fish in a little pond can sometimes be more important than your school itself.
è®°ä½å¯¹è‡ªå·±çš„èƒ½åŠ›æœ‰ä¿¡å¿ƒååˆ†é‡è¦ï¼Œåœ¨å°æ± å¡˜é‡Œæˆä¸ºå¤§é±¼æœ‰æ—¶å€™æ¯”å­¦æ ¡æœ¬èº«æ›´é‡è¦ã€‚

ç‚¹ç‚¹åˆ¸ï¼Œå¯ä»¥å…‘æ¢æ— é—¨æ§›çº¢åŒ…ï¼ˆ1å…ƒï¼Œ5å…ƒï¼Œ10å…ƒï¼Œ100å…ƒï¼Œéƒ¨åˆ†çº¢åŒ…éœ€æŠ¢è´­ï¼‰
æ´»åŠ¨å…¥å£ï¼šäº¬ä¸œAPP-é¢†åˆ¸ä¸­å¿ƒ/åˆ¸å9.9-é¢†ç‚¹ç‚¹åˆ¸
åœ°å€ï¼šhttps://h5.m.jd.com/babelDiy/Zeus/41Lkp7DumXYCFmPYtU3LTcnTTXTX/index.html
å·²æ”¯æŒIOSåŒäº¬ä¸œè´¦å·,Node.jsæ”¯æŒNä¸ªäº¬ä¸œè´¦å·
è„šæœ¬å…¼å®¹: QuantumultX, Surge, Loon, JSBox, Node.js
===============Quantumultx===============
[task_local]
#ç‚¹ç‚¹åˆ¸
10 0,20 * * * https://gitee.com/lxk0301/jd_scripts/raw/master/jd_necklace.js, tag=ç‚¹ç‚¹åˆ¸, img-url=https://raw.githubusercontent.com/Orz-3/task/master/jd.png, enabled=true

================Loon==============
[Script]
cron "10 0,20 * * *" script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_necklace.js,tag=ç‚¹ç‚¹åˆ¸

===============Surge=================
ç‚¹ç‚¹åˆ¸ = type=cron,cronexp="10 0,20 * * *",wake-system=1,timeout=3600,script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_necklace.js

============å°ç«ç®­=========
ç‚¹ç‚¹åˆ¸ = type=cron,script-path=https://gitee.com/lxk0301/jd_scripts/raw/master/jd_necklace.js, cronexpr="10 0,20 * * *", timeout=3600, enable=true
 */
const $ = new Env('ç‚¹ç‚¹åˆ¸');

const notify = $.isNode() ? require('./sendNotify') : '';
//Node.jsç”¨æˆ·è¯·åœ¨jdCookie.jså¤„å¡«å†™äº¬ä¸œck;
const jdCookieNode = $.isNode() ? require('./jdCookie.js') : '';
const openUrl = `openjd://virtual?params=%7B%20%22category%22:%20%22jump%22,%20%22des%22:%20%22m%22,%20%22url%22:%20%22https://h5.m.jd.com/babelDiy/Zeus/41Lkp7DumXYCFmPYtU3LTcnTTXTX/index.html%22%20%7D`
let message = '';
//IOSç­‰ç”¨æˆ·ç›´æ¥ç”¨NobyDaçš„jd cookie
let cookiesArr = [], cookie = '';
if ($.isNode()) {
  Object.keys(jdCookieNode).forEach((item) => {
    cookiesArr.push(jdCookieNode[item])
  })
  if (process.env.JD_DEBUG && process.env.JD_DEBUG === 'false') console.log = () => {};
} else {
  let cookiesData = $.getdata('CookiesJD') || "[]";
  cookiesData = jsonParse(cookiesData);
  cookiesArr = cookiesData.map(item => item.cookie);
  cookiesArr.reverse();
  cookiesArr.push(...[$.getdata('CookieJD2'), $.getdata('CookieJD')]);
  cookiesArr.reverse();
  cookiesArr = cookiesArr.filter(item => item !== "" && item !== null && item !== undefined);
}

const JD_API_HOST = 'https://api.m.jd.com/api';
!(async () => {
  if (!cookiesArr[0]) {
    $.msg($.name, 'ã€æç¤ºã€‘è¯·å…ˆè·å–äº¬ä¸œè´¦å·ä¸€cookie\nç›´æ¥ä½¿ç”¨NobyDaçš„äº¬ä¸œç­¾åˆ°è·å–', 'https://bean.m.jd.com/bean/signIndex.action', {"open-url": "https://bean.m.jd.com/bean/signIndex.action"});
    return;
  }
  for (let i = 0; i < cookiesArr.length; i++) {
    if (cookiesArr[i]) {
      cookie = cookiesArr[i];
      $.UserName = decodeURIComponent(cookie.match(/pt_pin=(.+?);/) && cookie.match(/pt_pin=(.+?);/)[1])
      $.index = i + 1;
      $.isLogin = true;
      $.nickName = '';
      message = '';
      await TotalBean();
      console.log(`\nå¼€å§‹ã€äº¬ä¸œè´¦å·${$.index}ã€‘${$.nickName || $.UserName}\n`);
      if (!$.isLogin) {
        $.msg($.name, `ã€æç¤ºã€‘cookieå·²å¤±æ•ˆ`, `äº¬ä¸œè´¦å·${$.index} ${$.nickName || $.UserName}\nè¯·é‡æ–°ç™»å½•è·å–\nhttps://bean.m.jd.com/bean/signIndex.action`, {"open-url": "https://bean.m.jd.com/bean/signIndex.action"});

        if ($.isNode()) {
          await notify.sendNotify(`${$.name}cookieå·²å¤±æ•ˆ - ${$.UserName}`, `äº¬ä¸œè´¦å·${$.index} ${$.UserName}\nè¯·é‡æ–°ç™»å½•è·å–cookie`);
        }
        continue
      }
      await jd_necklace();
    }
  }
})()
    .catch((e) => {
      $.log('', `âŒ ${$.name}, å¤±è´¥! åŸå› : ${e}!`, '')
    })
    .finally(() => {
      $.done();
    })
async function jd_necklace() {
  await necklace_homePage();
  await doTask();
  await necklace_homePage();
  await receiveBubbles();
  await sign();
  await necklace_homePage();
  // await necklace_exchangeGift(10);//è‡ªåŠ¨å…‘æ¢å¤šå°‘é’±çš„æ— é—¨æ§›çº¢åŒ…ï¼Œ1000ä»£è¡¨1å…ƒ
  await showMsg();
}
function showMsg() {
  return new Promise(async resolve => {
    let nowTimes = new Date(new Date().getTime() + new Date().getTimezoneOffset()*60*1000 + 8*60*60*1000);
    if (nowTimes.getHours() >= 20 && $.totalScore >= 10000) {
      $.msg($.name, '', `äº¬ä¸œè´¦å·${$.index} ${$.nickName}\nå½“å‰${$.name}ï¼š${$.totalScore}ä¸ª\nå¯å…‘æ¢æ— é—¨æ§›çº¢åŒ…ï¼š${$.totalScore / 1000}å…ƒ\nç‚¹å‡»å¼¹çª—å³å¯å»å…‘æ¢(æ³¨ï¼šæ­¤çº¢åŒ…å…·æœ‰æ—¶æ•ˆæ€§)`, { 'open-url': openUrl});
    }
    // äº‘ç«¯å¤§äº10å…ƒæ— é—¨æ§›çº¢åŒ…æ—¶è¿›è¡Œé€šçŸ¥æ¨é€
    if ($.isNode() && $.totalScore >= 10000 && nowTimes.getHours() >= 20) await notify.sendNotify(`${$.name} - äº¬ä¸œè´¦å·${$.index} - ${$.nickName}`, `äº¬ä¸œè´¦å·${$.index} ${$.nickName}\nå½“å‰${$.name}ï¼š${$.totalScore}ä¸ª\nå¯å…‘æ¢æ— é—¨æ§›çº¢åŒ…ï¼š${$.totalScore / 1000}å…ƒ\nç‚¹å‡»é“¾æ¥å³å¯å»å…‘æ¢(æ³¨ï¼šæ­¤çº¢åŒ…å…·æœ‰æ—¶æ•ˆæ€§)\nâ†“â†“â†“ \n\n ${openUrl} \n\n â†‘â†‘â†‘`, { url: openUrl })
    resolve()
  })
}
async function doTask() {
  for (let item of $.taskConfigVos) {
    if (item.taskStage === 0) {
      console.log(`${item.taskName}æœªå®Œæˆ`);
      await necklace_startTask(item.id);
      await $.wait(2000);
      await necklace_startTask(item.id);
    } else if (item.taskStage === 2) {
      console.log(`${item.taskName}ä»»åŠ¡å·²åšå®Œ,å¥–åŠ±æœªé¢†å–`);
    } else if (item.taskStage === 3) {
      console.log(`${item.taskName}å¥–åŠ±å·²é¢†å–`);
    } else if (item.taskStage === 1) {
      console.log(`${item.taskName}ä»»åŠ¡æœªå®Œæˆ\n`);
    }
  }
}
async function receiveBubbles() {
  for (let item of $.bubbles) {
    console.log(`å¼€å§‹é¢†å–ç‚¹ç‚¹åˆ¸\n`);
    await necklace_chargeScores(item.id)
  }
}
async function sign() {
  if ($.signInfo.todayCurrentSceneSignStatus === 1) {
    await necklace_sign();
  } else {
    console.log(`å½“å‰${new Date(new Date().getTime() + new Date().getTimezoneOffset()*60*1000 + 8*60*60*1000).toLocaleString()}å·²ç­¾åˆ°`)
  }
}
//æ¯æ—¥ç­¾åˆ°ç¦åˆ©
function necklace_sign() {
  return new Promise(resolve => {
    const body = {
      currentDate: $.lastRequestTime.replace(/:/g, "%3A"),
    }
    $.post(taskPostUrl("necklace_sign", body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.rtn_code === 0) {
              if (data.data.biz_code === 0) {
                console.log(`ç­¾åˆ°æˆåŠŸï¼Œæ—¶é—´ï¼š${new Date(new Date().getTime() + new Date().getTimezoneOffset()*60*1000 + 8*60*60*1000).toLocaleString()}`)
                // $.taskConfigVos = data.data.result.taskConfigVos;
                // $.exchangeGiftConfigs = data.data.result.exchangeGiftConfigs;
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
//å…‘æ¢æ— é—¨æ§›çº¢åŒ…
function necklace_exchangeGift(scoreNums) {
  return new Promise(resolve => {
    const body = {
      scoreNums,
      "giftConfigId": 31,
      currentDate: $.lastRequestTime.replace(/:/g, "%3A"),
    }
    $.post(taskPostUrl("necklace_exchangeGift", body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.rtn_code === 0) {
              if (data.data.biz_code === 0) {
                const { result } = data.data;
                message += `${result.redpacketTitle}ï¼š${result.redpacketAmount}å…ƒå…‘æ¢æˆåŠŸ\n`;
                message += `çº¢åŒ…æœ‰æ•ˆæœŸï¼š${new Date(result.endTime + new Date().getTimezoneOffset()*60*1000 + 8*60*60*1000).toLocaleString('zh', {hour12: false})}`;
                console.log(message)
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
//é¢†å–å¥–åŠ±
function necklace_chargeScores(bubleId) {
  return new Promise(resolve => {
    const body = {
      bubleId,
      currentDate: $.lastRequestTime.replace(/:/g, "%3A"),
    }
    $.post(taskPostUrl("necklace_chargeScores", body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.rtn_code === 0) {
              if (data.data.biz_code === 0) {
                // $.taskConfigVos = data.data.result.taskConfigVos;
                // $.exchangeGiftConfigs = data.data.result.exchangeGiftConfigs;
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve(data);
      }
    })
  })
}
function necklace_startTask(taskId) {
  return new Promise(resolve => {
    const body = {
      taskId,
      currentDate: $.lastRequestTime.replace(/:/g, "%3A"),
    }
    $.post(taskPostUrl("necklace_startTask", body), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.rtn_code === 0) {
              if (data.data.biz_code === 0) {
                // $.taskConfigVos = data.data.result.taskConfigVos;
                // $.exchangeGiftConfigs = data.data.result.exchangeGiftConfigs;
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve();
      }
    })
  })
}
function necklace_homePage() {
  return new Promise(resolve => {
    $.post(taskPostUrl('necklace_homePage'), async (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (safeGet(data)) {
            data = JSON.parse(data);
            if (data.rtn_code === 0) {
              if (data.data.biz_code === 0) {
                $.taskConfigVos = data.data.result.taskConfigVos;
                $.exchangeGiftConfigs = data.data.result.exchangeGiftConfigs;
                $.lastRequestTime = data.data.result.lastRequestTime;
                $.bubbles = data.data.result.bubbles;
                $.signInfo = data.data.result.signInfo;
                $.totalScore = data.data.result.totalScore;
              }
            }
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve();
      }
    })
  })
}
function taskPostUrl(function_id, body = {}) {
  const time = new Date().getTime() + new Date().getTimezoneOffset()*60*1000 + 8*60*60*1000;
  return {
    url: `${JD_API_HOST}?functionId=${function_id}&appid=jd_mp_h5&loginType=2&client=jd_mp_h5&t=${time}&body=${escape(JSON.stringify(body))}`,
    headers: {
      "Cookie": cookie,
      "User-Agent": $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0"),
    }
  }
}
function TotalBean() {
  return new Promise(async resolve => {
    const options = {
      "url": `https://wq.jd.com/user/info/QueryJDUserInfo?sceneval=2`,
      "headers": {
        "Accept": "application/json,text/plain, */*",
        "Content-Type": "application/x-www-form-urlencoded",
        "Accept-Encoding": "gzip, deflate, br",
        "Accept-Language": "zh-cn",
        "Connection": "keep-alive",
        "Cookie": cookie,
        "Referer": "https://wqs.jd.com/my/jingdou/my.shtml?sceneval=2",
        "User-Agent": $.isNode() ? (process.env.JD_USER_AGENT ? process.env.JD_USER_AGENT : (require('./USER_AGENTS').USER_AGENT)) : ($.getdata('JDUA') ? $.getdata('JDUA') : "jdapp;iPhone;9.2.2;14.2;%E4%BA%AC%E4%B8%9C/9.2.2 CFNetwork/1206 Darwin/20.1.0")
      }
    }
    $.post(options, (err, resp, data) => {
      try {
        if (err) {
          console.log(`${JSON.stringify(err)}`)
          console.log(`${$.name} APIè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘è·¯é‡è¯•`)
        } else {
          if (data) {
            data = JSON.parse(data);
            if (data['retcode'] === 13) {
              $.isLogin = false; //cookieè¿‡æœŸ
              return
            }
            $.nickName = data['base'].nickname;
          } else {
            console.log(`äº¬ä¸œæœåŠ¡å™¨è¿”å›ç©ºæ•°æ®`)
          }
        }
      } catch (e) {
        $.logErr(e, resp)
      } finally {
        resolve();
      }
    })
  })
}
function safeGet(data) {
  try {
    if (typeof JSON.parse(data) == "object") {
      return true;
    }
  } catch (e) {
    console.log(e);
    console.log(`äº¬ä¸œæœåŠ¡å™¨è®¿é—®æ•°æ®ä¸ºç©ºï¼Œè¯·æ£€æŸ¥è‡ªèº«è®¾å¤‡ç½‘ç»œæƒ…å†µ`);
    return false;
  }
}
function jsonParse(str) {
  if (typeof str == "string") {
    try {
      return JSON.parse(str);
    } catch (e) {
      console.log(e);
      $.msg($.name, '', 'è¯·å‹¿éšæ„åœ¨BoxJsè¾“å…¥æ¡†ä¿®æ”¹å†…å®¹\nå»ºè®®é€šè¿‡è„šæœ¬å»è·å–cookie')
      return [];
    }
  }
}
// prettier-ignore
function Env(t,e){"undefined"!=typeof process&&JSON.stringify(process.env).indexOf("GITHUB")>-1&&process.exit(0);class s{constructor(t){this.env=t}send(t,e="GET"){t="string"==typeof t?{url:t}:t;let s=this.get;return"POST"===e&&(s=this.post),new Promise((e,i)=>{s.call(this,t,(t,s,r)=>{t?i(t):e(s)})})}get(t){return this.send.call(this.env,t)}post(t){return this.send.call(this.env,t,"POST")}}return new class{constructor(t,e){this.name=t,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,e),this.log("",`ğŸ””${this.name}, å¼€å§‹!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(t,e=null){try{return JSON.parse(t)}catch{return e}}toStr(t,e=null){try{return JSON.stringify(t)}catch{return e}}getjson(t,e){let s=e;const i=this.getdata(t);if(i)try{s=JSON.parse(this.getdata(t))}catch{}return s}setjson(t,e){try{return this.setdata(JSON.stringify(t),e)}catch{return!1}}getScript(t){return new Promise(e=>{this.get({url:t},(t,s,i)=>e(i))})}runScript(t,e){return new Promise(s=>{let i=this.getdata("@chavy_boxjs_userCfgs.httpapi");i=i?i.replace(/\n/g,"").trim():i;let r=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout");r=r?1*r:20,r=e&&e.timeout?e.timeout:r;const[o,h]=i.split("@"),n={url:`http://${h}/v1/scripting/evaluate`,body:{script_text:t,mock_type:"cron",timeout:r},headers:{"X-Key":o,Accept:"*/*"}};this.post(n,(t,e,i)=>s(i))}).catch(t=>this.logErr(t))}loaddata(){if(!this.isNode())return{};{this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e);if(!s&&!i)return{};{const i=s?t:e;try{return JSON.parse(this.fs.readFileSync(i))}catch(t){return{}}}}}writedata(){if(this.isNode()){this.fs=this.fs?this.fs:require("fs"),this.path=this.path?this.path:require("path");const t=this.path.resolve(this.dataFile),e=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(t),i=!s&&this.fs.existsSync(e),r=JSON.stringify(this.data);s?this.fs.writeFileSync(t,r):i?this.fs.writeFileSync(e,r):this.fs.writeFileSync(t,r)}}lodash_get(t,e,s){const i=e.replace(/\[(\d+)\]/g,".$1").split(".");let r=t;for(const t of i)if(r=Object(r)[t],void 0===r)return s;return r}lodash_set(t,e,s){return Object(t)!==t?t:(Array.isArray(e)||(e=e.toString().match(/[^.[\]]+/g)||[]),e.slice(0,-1).reduce((t,s,i)=>Object(t[s])===t[s]?t[s]:t[s]=Math.abs(e[i+1])>>0==+e[i+1]?[]:{},t)[e[e.length-1]]=s,t)}getdata(t){let e=this.getval(t);if(/^@/.test(t)){const[,s,i]=/^@(.*?)\.(.*?)$/.exec(t),r=s?this.getval(s):"";if(r)try{const t=JSON.parse(r);e=t?this.lodash_get(t,i,""):e}catch(t){e=""}}return e}setdata(t,e){let s=!1;if(/^@/.test(e)){const[,i,r]=/^@(.*?)\.(.*?)$/.exec(e),o=this.getval(i),h=i?"null"===o?null:o||"{}":"{}";try{const e=JSON.parse(h);this.lodash_set(e,r,t),s=this.setval(JSON.stringify(e),i)}catch(e){const o={};this.lodash_set(o,r,t),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(t,e);return s}getval(t){return this.isSurge()||this.isLoon()?$persistentStore.read(t):this.isQuanX()?$prefs.valueForKey(t):this.isNode()?(this.data=this.loaddata(),this.data[t]):this.data&&this.data[t]||null}setval(t,e){return this.isSurge()||this.isLoon()?$persistentStore.write(t,e):this.isQuanX()?$prefs.setValueForKey(t,e):this.isNode()?(this.data=this.loaddata(),this.data[e]=t,this.writedata(),!0):this.data&&this.data[e]||null}initGotEnv(t){this.got=this.got?this.got:require("got"),this.cktough=this.cktough?this.cktough:require("tough-cookie"),this.ckjar=this.ckjar?this.ckjar:new this.cktough.CookieJar,t&&(t.headers=t.headers?t.headers:{},void 0===t.headers.Cookie&&void 0===t.cookieJar&&(t.cookieJar=this.ckjar))}get(t,e=(()=>{})){t.headers&&(delete t.headers["Content-Type"],delete t.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)})):this.isQuanX()?(this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t))):this.isNode()&&(this.initGotEnv(t),this.got(t).on("redirect",(t,e)=>{try{if(t.headers["set-cookie"]){const s=t.headers["set-cookie"].map(this.cktough.Cookie.parse).toString();s&&this.ckjar.setCookieSync(s,null),e.cookieJar=this.ckjar}}catch(t){this.logErr(t)}}).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)}))}post(t,e=(()=>{})){if(t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(t,(t,s,i)=>{!t&&s&&(s.body=i,s.statusCode=s.status),e(t,s,i)});else if(this.isQuanX())t.method="POST",this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>e(t));else if(this.isNode()){this.initGotEnv(t);const{url:s,...i}=t;this.got.post(s,i).then(t=>{const{statusCode:s,statusCode:i,headers:r,body:o}=t;e(null,{status:s,statusCode:i,headers:r,body:o},o)},t=>{const{message:s,response:i}=t;e(s,i,i&&i.body)})}}time(t,e=null){const s=e?new Date(e):new Date;let i={"M+":s.getMonth()+1,"d+":s.getDate(),"H+":s.getHours(),"m+":s.getMinutes(),"s+":s.getSeconds(),"q+":Math.floor((s.getMonth()+3)/3),S:s.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(s.getFullYear()+"").substr(4-RegExp.$1.length)));for(let e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t}msg(e=t,s="",i="",r){const o=t=>{if(!t)return t;if("string"==typeof t)return this.isLoon()?t:this.isQuanX()?{"open-url":t}:this.isSurge()?{url:t}:void 0;if("object"==typeof t){if(this.isLoon()){let e=t.openUrl||t.url||t["open-url"],s=t.mediaUrl||t["media-url"];return{openUrl:e,mediaUrl:s}}if(this.isQuanX()){let e=t["open-url"]||t.url||t.openUrl,s=t["media-url"]||t.mediaUrl;return{"open-url":e,"media-url":s}}if(this.isSurge()){let e=t.url||t.openUrl||t["open-url"];return{url:e}}}};if(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,s,i,o(r)):this.isQuanX()&&$notify(e,s,i,o(r))),!this.isMuteLog){let t=["","==============ğŸ“£ç³»ç»Ÿé€šçŸ¥ğŸ“£=============="];t.push(e),s&&t.push(s),i&&t.push(i),console.log(t.join("\n")),this.logs=this.logs.concat(t)}}log(...t){t.length>0&&(this.logs=[...this.logs,...t]),console.log(t.join(this.logSeparator))}logErr(t,e){const s=!this.isSurge()&&!this.isQuanX()&&!this.isLoon();s?this.log("",`â—ï¸${this.name}, é”™è¯¯!`,t.stack):this.log("",`â—ï¸${this.name}, é”™è¯¯!`,t)}wait(t){return new Promise(e=>setTimeout(e,t))}done(t={}){const e=(new Date).getTime(),s=(e-this.startTime)/1e3;this.log("",`ğŸ””${this.name}, ç»“æŸ! ğŸ•› ${s} ç§’`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(t)}}(t,e)}
